;/*FB_PKG_DELIM*/

__d("EncryptedBackupsDYIGenerateThreadMetadata",["CurrentUser","EncryptedBackupsDYISingleton","I64","IGDWebUtils","LSMessagingThreadTypeUtil","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){return d("IGDWebUtils").isOnInstagramWeb()?(i||(i=d("I64"))).of_string(c("CurrentUser").getEIMU()):(i||(i=d("I64"))).of_string(c("CurrentUser").getAccountID())}function k(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.threads).getKeyRange((i||(i=d("I64"))).of_string(b)))}function l(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.contacts).getKeyRange(b))}function a(a,b){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.contacts).filter(function(a){return b.has((i||(i=d("I64"))).to_string(a.id))}))}function m(a,b){var c;return(c=d("ReQL")).toArrayAsync(c.leftJoin(c.fromTableAscending(a.tables.participants,["contactId"]).getKeyRange(b),c.fromTableAscending(a.tables.contacts,["name"])))}function n(a){return d("LSMessagingThreadTypeUtil").isOneToOne(a)||d("LSMessagingThreadTypeUtil").isOpenOneToOne(a)}function o(a,b,c){if(c!=null&&c.trim()!=="")return c+"_"+b;switch(a.length){case 0:return"Thread_"+b;case 1:return a[0]+"_"+b;case 2:return a[0]+"and"+a[1]+"_"+b;case 3:return""+a[0]+a[1]+"and"+a[2]+"_"+b;case 4:return""+a[0]+a[1]+a[2]+"and1other_"+b;default:return""+a[0]+a[1]+a[2]+"and"+(a.length-3)+"others_"+b}}function p(a,b,c,d,e,f,g){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){var j=[],p=[g];g=(yield k(e,a));if(g!=null)if(n(g.threadType)){var q=(yield l(e,g.threadKey));(q==null?void 0:q.id)!=null&&(q==null?void 0:q.name)!=null&&c.setContactNameForContactId((i||(i=d("I64"))).to_string(q.id),q.name);q=(q==null?void 0:q.name)||"Unknown User";j.push(q);p.push(q);c.setThreadMetaDataByThreadId((i||(i=d("I64"))).to_string(g.threadKey),p,o(j,h,g.threadName))}else{q=(yield m(e,g.threadKey));q.forEach(function(a){var b=a[0];a=a[1];(b==null?void 0:b.contactId)!=null&&(a==null?void 0:a.name)!=null&&c.setContactNameForContactId((i||(i=d("I64"))).to_string(b.contactId),a.name);if(!(i||(i=d("I64"))).equal(b.contactId,f)){b=(a==null?void 0:a.name)||"Unknown User";j.push(b);p.push(b)}});c.setThreadMetaDataByThreadId(b.get((i||(i=d("I64"))).to_string(g.threadKey))||"0",p,o(j,h,g.threadName))}else c.setThreadMetaDataByThreadId(b.get(a)||"0",p,o(j,h))});return q.apply(this,arguments)}function e(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e,f=d("EncryptedBackupsDYISingleton").getSingleton(),g=(yield f.getDB()),k=(yield l(g,j())),m=(e=k==null?void 0:k.id)!=null?e:(i||(i=d("I64"))).zero,n=(e=k==null?void 0:k.name)!=null?e:"Me";f.setContactNameForContactId((i||(i=d("I64"))).to_string(m),n);return a.reduce(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,d){yield a;return p(b,c,f,g,m,n,d)});return function(b,c,d){return a.apply(this,arguments)}}(),(h||(h=b("Promise"))).resolve())});return r.apply(this,arguments)}g.getAllUnmappedContacts=a;g.EncryptedBackupsDYIGenerateThreadMetadata=e}),98);
__d("EncryptedBackupsDYIZipUtils",["EncryptedBackupsDYIFileUtils","Promise","asyncToGeneratorRuntime","jszip"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=new(c("jszip"))();for(a of a){var g=a.threadName+".json";f.file(g,JSON.stringify(a,null,2))}var i=(yield d("EncryptedBackupsDYIFileUtils").getMediaFolderHandle());yield (h||(h=b("Promise"))).all(e.map(function(a){return j(f,i,a)}));return f.generateAsync({compression:"DEFLATE",compressionOptions:{level:6},type:"blob"})});return i.apply(this,arguments)}function j(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=c.split("/").pop();b=(yield d("EncryptedBackupsDYIFileUtils").readFile(b,e));a.file(c,b)});return k.apply(this,arguments)}g.generateZipFile=a}),98);
__d("EncryptedBackupsDYISingleton",["EncryptedBackupsDYIFileUtils","EncryptedBackupsDYIGenerateThreadMetadata","EncryptedBackupsDYISingletonFactory","EncryptedBackupsDYITypes","EncryptedBackupsDYIZipUtils","FBLogger","I64","LSIntEnum","MAWBridge","MAWQplProxy","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["DYI Exiting Early - Found "," instamadillo threads"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Updating DYI status with state BACKUP_RESTORE_SUCCESSFUL"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Writing file to user storage"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Generating zip file"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Generating output"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Fetched remaining contact names, total of "," contacts"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["DYI flow complete - generating output"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["DYI flow complete - generating output"]);q=function(){return a};return a}var r=null;function s(){try{return WorkerGlobalScope!==void 0&&self instanceof WorkerGlobalScope}catch(a){return!1}}function a(a,b,e){if(r==null)switch(a){case d("EncryptedBackupsDYITypes").EncryptedBackupsDYIConfig.Armadillo:if(s())throw c("FBLogger")("labyrinth_web").mustfixThrow("EncryptedBackupsDYISingleton for Armadillo can only be initialised in the main thread");r=d("EncryptedBackupsDYISingletonFactory").getMAWEncryptedBackupsDYISingleton(b,e);break;case d("EncryptedBackupsDYITypes").EncryptedBackupsDYIConfig.Instamadillo:if(!s())throw c("FBLogger")("labyrinth_web").mustfixThrow("EncryptedBackupsDYISingleton for Instamadillo can only be initialised in the worker");r=d("EncryptedBackupsDYISingletonFactory").getIGDEncryptedBackupsDYISingleton(b,e);break}}function e(){if(r==null)throw c("FBLogger")("labyrinth_web").mustfixThrow("EncryptedBackupsDYISingleton is not initialised. Please call EncryptedBackupsDYISingleton.initSingleton() first.");return r}var t=function(){var c=a.prototype;c.getDB=function(){return this.$1()};c.getLogger=function(){return this.$4};function a(a,b,c,d){this.$5=new Map(),this.$6=new Set(),this.$7=new Set(),this.$8=new Map(),this.$9=new Map(),this.$10=new Map(),this.$1=a,this.$2=b,this.$3=c,this.$4=d}c.getAllMediaUrls=function(){return Array.from(this.$5.values())};c.$11=function(a){return this.$5.get(a)};c.setMediaUrlByPlainTextHash=function(a,b){if(this.$5.has(a))return;this.$5.set(a,b)};c.addThreadKeyToThreadsRestoreInProgress=function(a){this.$6.add(a)};c.isThreadRestoreInProgressForThreadKey=function(a){return this.$6.has(a)};c.deleteThreadKeyFromThreadsRestoreInProgress=function(a){this.$6["delete"](a),this.$12()&&(void this.$4.LOG(q()),void this.$13()),this.logDYIQPLPoint("message_restore_complete_"+this.$6.size.toString())};c.isThreadsRestoreComplete=function(){return this.$6.size===0};c.addPlaintextHashToAttachmentDownloadsInProgress=function(a){this.$7.add(a)};c.deletePlaintextHashFromAttachmentDownloadsInProgress=function(a){this.$7["delete"](a),this.$12()&&(void this.$4.LOG(p()),void this.$13())};c.isAttachmentDownloadInProgressForPlaintextHash=function(a){return this.$7.has(a)};c.isAttachmentDownloadCompleteForPlaintextHash=function(a){return!!this.$5.get(a)};c.isAttachmentDownloadComplete=function(){return this.$7.size===0};c.setMessagesByThreadKey=function(a,b,c){a=this.getMessagesByThreadKey(a);a.set(b,c)};c.getMessagesByThreadKey=function(a){this.$14(a)||this.$8.set(a,new Map());return this.$8.get(a)};c.$14=function(a){return this.$8.has(a)};c.setThreadMetaDataByThreadId=function(a,b,c){this.$9.set(a,{participants:b,threadName:c})};c.getThreadMetadataMap=function(){return this.$9};c.setContactNameForContactId=function(a,b){this.$10.set(a,b)};c.getContactNameForContactId=function(a){return this.$10.get(a)};c.getContactNameMap=function(){return this.$10};c.getOutput=function(){var a=this;return Array.from(this.getThreadMetadataMap(),function(b){var c=b[0];b=b[1];var d=a.$14(c);d=d?Array.from(a.getMessagesByThreadKey(c),function(b){b[0];b=b[1];return babelHelpers["extends"]({},b,{media:Array.from(b.media,function(b){b=a.$11(b);return{uri:b!=null?"./"+b:"Failed to download media"}})})}):[];d=d.map(function(b){var c=b.senderId,d=babelHelpers.objectWithoutPropertiesLoose(b,["senderId"]);if(c!=null&&d.senderName==="Unknown User"){c=a.getContactNameForContactId(c);if(c!=null)return babelHelpers["extends"]({},d,{senderName:c})}return b});c=d.sort(function(a,b){return typeof a.timestamp==="number"&&typeof b.timestamp==="number"?a.timestamp-b.timestamp:0});return babelHelpers["extends"]({},b,{messages:c})})};c.$12=function(){return this.isAttachmentDownloadComplete()&&this.isThreadsRestoreComplete()};c.$15=function(a){switch(a){case 0:return d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.InProgress;case 1:return d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Completed;case 2:return d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Failed;case-1:default:return d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.NotStarted}};c.updateDYIStatus=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=(yield this.getDB());yield c.runInTransaction(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield b.encrypted_backups_dyi_backup_restore_status.put({currentStatus:(h||(h=d("LSIntEnum"))).ofNumber(a),pk:(i||(i=d("I64"))).zero})});return function(a){return c.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":481");d("MAWBridge").getBridge().fireAndForget("event","updateDYIStatus",{status:this.$15(a)})});function c(b){return a.apply(this,arguments)}return c}();c.$16=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this,b=new Set();this.getContactNameMap().forEach(function(a,c){a==="Unknown User"&&b.add(c)});var c=(yield this.getDB());c=(yield d("EncryptedBackupsDYIGenerateThreadMetadata").getAllUnmappedContacts(c,b));c.forEach(function(b){var c=(i||(i=d("I64"))).to_string(b.id);a.setContactNameForContactId(c,b.name)});void this.$4.LOG(o(),this.getContactNameMap().size.toString())});function c(){return a.apply(this,arguments)}return c}();c.$13=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){this.logDYIQPLPoint("complete_dyi_flow_start");yield this.$16();void this.$4.LOG(n());var a=this.getOutput(),b=Array.from(this.$5.values());this.logDYIQPLPoint("write_file_start");void this.$4.LOG(m());a=(yield d("EncryptedBackupsDYIZipUtils").generateZipFile(a,b));b=(yield a.arrayBuffer());a=(yield d("EncryptedBackupsDYIFileUtils").getRootFolderHandle());void this.$4.LOG(l());var c="messages.zip";yield d("EncryptedBackupsDYIFileUtils").writeFile(a,c,b);this.logDYIQPLPoint("write_file_end");void this.$4.LOG(k());this.logDYIQPLPoint("complete_dyi_flow_end");yield this.updateDYIStatus(1);void this.clear()});function c(){return a.apply(this,arguments)}return c}();c.exitDYIEarly=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b!=null&&this.$4.LOG(j(),b),this.logDYIQPLPoint("dyi_exit_early",{"int":{dyi_threads:b}}),yield this.updateDYIStatus(a?2:1),void this.clear()});function c(b,c){return a.apply(this,arguments)}return c}();c.clear=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){this.$5=new Map();this.$6=new Set();this.$7=new Set();this.$8=new Map();this.$9=new Map();var a=(yield d("EncryptedBackupsDYIFileUtils").getRootFolderHandle());yield a.removeEntry(d("EncryptedBackupsDYIFileUtils").DyiMediaFolder,{recursive:!0})});function c(){return a.apply(this,arguments)}return c}();c.logDYIQPLPoint=function(a,b){this.$3!=null&&d("MAWQplProxy").sendQplPointThroughBridge(this.$2,a,{annotations:b,instanceKey:this.$3})};return a}();g.initSingleton=a;g.getSingleton=e;g.EncryptedBackupsDYISingleton=t}),98);
__d("EncryptedBackupsDYISingletonFactory",["EncryptedBackupsDYISingleton","WATagsLogger","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return new(d("EncryptedBackupsDYISingleton").EncryptedBackupsDYISingleton)(a,c("qpl")._(521478596,"1329"),b,d("WATagsLogger").TAGS(["labyrinth_web","labyrinth_dyi",b==null?"":b.toString()]))}function b(a,b){return new(d("EncryptedBackupsDYISingleton").EncryptedBackupsDYISingleton)(a,c("qpl")._(521479842,"2163"),b,d("WATagsLogger").TAGS(["igd_labyrinth_web","igd_dyi",b==null?"":b.toString()]))}g.getMAWEncryptedBackupsDYISingleton=a;g.getIGDEncryptedBackupsDYISingleton=b}),98);
__d("IGDAWAdminWriteICDCMsgTxn",["Promise","cr:2327","cr:7625"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(c=b("cr:2327"))!=null?c:b("cr:7625");function a(a,c,d){return i?i.writeICDCAdminMsg(a,c,d):(h||(h=b("Promise"))).resolve()}g.writeICDCAdminMsg=a}),98);
__d("IGDAWAdminWriteUserDeviceMsgTxn",["Promise","cr:2693","cr:7627"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(c=b("cr:2693"))!=null?c:b("cr:7627");function a(a,c,d,e,f,g){return i?i.writeUserDeviceAdminMsg(a,c,d,e,f,g):(h||(h=b("Promise"))).resolve()}g.writeUserDeviceAdminMsg=a}),98);
__d("IGDAWDbAddDeviceChangeAlertsTxn",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function a(a,b){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield a.e2ee_deviceChangeAlerts.put(b)});return g.apply(this,arguments)}f.addDeviceChangeAlertsTxn=a}),66);
__d("IGDAWDbUpdateDeviceChangeAlertsTxn",["I64","MAWUnsafeCoerce","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield a.e2ee_deviceChangeAlerts.upsert([b.deviceChangeAlertsId],b)});return i.apply(this,arguments)}function c(a){return d("MAWUnsafeCoerce").unsafeCoerce((h||(h=d("I64"))).of_float(a))}g.updateDeviceChangeAlertsTxn=a;g.convertDeviceChangeAlertsId=c}),98);
__d("IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn",["IGDAWDbUpdateDeviceChangeAlertsTxn","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(a.e2ee_deviceChangeAlerts.index("deviceJid")).getKeyRange(c).filter(function(a){return!a.loggedOut})));yield (h||(h=b("Promise"))).all(c.map(function(b){return d("IGDAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn(a,babelHelpers["extends"]({},b,{loggedOut:!0}))}))});return i.apply(this,arguments)}g.updateDeviceChangeAlertsLogInStatusTxn=a}),98);
__d("IGDDbThreadTxns",["I64","Promise","ReQL","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){return new Map(yield a.runInTransaction(function(a){return(i||(i=b("Promise"))).all(c.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c;b=d("WAJids").extractUserId(b);return[b,yield (c=d("ReQL")).toArrayAsync(c.mergeJoin(c.fromTableAscending(a.participants.index("contactIdThreadKey"),[]).getKeyRange((h||(h=d("I64"))).of_string(b)),d("ReQL").fromTableAscending(a.threads)).map(function(a){a[0];a=a[1];return a}))]});return function(a){return c.apply(this,arguments)}}()))},"readonly",void 0,void 0,f.id+":24"))});return j.apply(this,arguments)}g.getAllThreadsForUsers=a}),98);
__d("IGDHandleICDCErrorInstruction",["IGDAWAdminWriteICDCMsgTxn","MAWODSProxy","Promise","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.shouldShowAdminMessages,i=e.threads;if(!g)return;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield (h||(h=b("Promise"))).all(i.map(function(b){return d("IGDAWAdminWriteICDCMsgTxn").writeICDCAdminMsg(a,b,c.notificationTs)})),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.ICDC,key:"icdc"})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":30")});return i.apply(this,arguments)}g.handleICDCError=a}),98);
__d("IGDHandleIdentityAddedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDAWDbAddDeviceChangeAlertsTxn","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","Promise","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.allowSecurityAlertForSelf,i=e.contactId,k=e.isMe,l=e.shouldShowAdminMessages,m=e.threads;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=j(a,c,k,g),f=e.promise;e=e.showSelfAlerts;var n=l?m.map(function(b){return d("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,i,k,b,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.add,c.notificationTs)}):[];yield (h||(h=b("Promise"))).all([f].concat(n));(e||l)&&d("MAWODSProxy").odsBumpEntityKey({entity:k?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").ADD})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":47")});return i.apply(this,arguments)}function j(a,c,e,f){var g=!1,i=(h||(h=b("Promise"))).resolve();if(e&&c.model!=null&&c.platform!=null&&c.notificationTs!=null){g=!0;e=c.instruction==="identityChanged"?d("MAWDbDeviceChangeAlerts").KEY_CHANGE:d("MAWDbDeviceChangeAlerts").ADD;i=d("IGDAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(a,{action:e,deviceJid:c.device,identity:c.identity,isArchived:!f,isConfirmed:!1,isNotified:!1,model:c.model,platform:c.platform,ts:c.notificationTs})}return{promise:i,showSelfAlerts:g}}g.handleIdentityAdded=a;g.addDeviceChangeAlerts=j}),98);
__d("IGDHandleIdentityChangedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDHandleIdentityAddedInstruction","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","Promise","WAJids","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.allowSecurityAlertForSelf,i=e.isMe,j=e.shouldShowAdminMessages,k=e.threads;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=d("IGDHandleIdentityAddedInstruction").addDeviceChangeAlerts(a,c,i,g),f=e.promise;e=e.showSelfAlerts;var l=j?k.map(function(b){return d("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,d("WAJids").extractUserId(c.jid),i,b,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.update,c.notificationTs)}):[];yield (h||(h=b("Promise"))).all([f].concat(l));(e||j)&&d("MAWODSProxy").odsBumpEntityKey({entity:i?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").KEY_CHANGE})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":31")});return i.apply(this,arguments)}g.handleIdentityChanged=a}),98);
__d("IGDHandleIdentityRemovedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","Promise","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.contactId,i=e.isMe,j=e.shouldShowAdminMessages,k=e.threads;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=i?d("IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn(a,c.device):(h||(h=b("Promise"))).resolve(),f=j?k.map(function(b){return d("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,g,i,b,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.remove,c.notificationTs)}):[];yield (h||(h=b("Promise"))).all([e].concat(f));(i||j)&&d("MAWODSProxy").odsBumpEntityKey({entity:i?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").REMOVE})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":30")});return i.apply(this,arguments)}g.handleIdentityRemoved=a}),98);
__d("IGDAWProtocolQueueInstructions",["FBLogger","IGDDbThreadTxns","IGDHandleICDCErrorInstruction","IGDHandleIdentityAddedInstruction","IGDHandleIdentityChangedInstruction","IGDHandleIdentityRemovedInstruction","MAWDbAppMeta","MAWReStoreDb","Promise","WAAssertUnreachable","WAGlobals","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("MAWReStoreDb").getDB()),e=(yield j(b,a)),f=e[0],g=f.allowSecurityAlertForContact;f=f.allowSecurityAlertForSelf;e=e[1];var h=[];for(a of a){var i=a.jid,k=d("WAJids").extractUserId(i);i=i===d("WAGlobals").getMyUserJid();var m=l({allowSecurityAlertForContact:g,isICDCError:a.instruction==="icdcError",isMe:i});m={allowSecurityAlertForSelf:f,contactId:k,isMe:i,shouldShowAdminMessages:m,threads:(i=e.get(k))!=null?i:[]};try{yield o(b,a,m),h.push(a.stanzaQueueId)}catch(a){c("FBLogger")("igd_web_on_msgr").warn("Failed to handle instruction. The error is %s",a)}}return{followUpParams:void 0,toAck:h}});return i.apply(this,arguments)}function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=new Set(b.map(function(a){return a.jid})),e=(yield m(a)),f=e.allowSecurityAlertForContact&&b.some(function(a){return a.jid!==d("WAGlobals").getMyUserJid()});b=b.some(function(a){return a.instruction==="icdcError"});f=f||b;b=f?yield d("IGDDbThreadTxns").getAllThreadsForUsers(a,Array.from(c)):new Map();return[e,b]});return k.apply(this,arguments)}function l(a){var b=a.allowSecurityAlertForContact,c=a.isICDCError;a=a.isMe;return!a&&(b||c)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield (h||(h=b("Promise"))).all([a.tables.e2ee_appMeta.get(d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf),a.tables.e2ee_appMeta.get(d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert)]));var c=a[0];a=a[1];return{allowSecurityAlertForContact:(a=a==null?void 0:a.value.allowSecurityAlert)!=null?a:!1,allowSecurityAlertForSelf:(a=c==null?void 0:c.value.allowSecurityAlertForSelf)!=null?a:!0}});return n.apply(this,arguments)}function o(a,b,e){switch(b.instruction){case"identityChanged":return d("IGDHandleIdentityChangedInstruction").handleIdentityChanged(a,b,e);case"identityAdded":return d("IGDHandleIdentityAddedInstruction").handleIdentityAdded(a,b,e);case"identityRemoved":return d("IGDHandleIdentityRemovedInstruction").handleIdentityRemoved(a,b,e);case"icdcError":return d("IGDHandleICDCErrorInstruction").handleICDCError(a,b,e);default:throw c("WAAssertUnreachable")(b)}}g.handleInstructions=a;g.getShouldShowAdminMessages=l}),98);
__d("IGDAWProtocolQueueReceipt",["WADbHandlePermitedIdentitiesApi","WAReceiptUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WADbHandlePermitedIdentitiesApi").handlePermitedIdentitiesPerDevice(d("WAReceiptUtils").calculateIdentitiesToDelete(a)).then(function(){return{followUpParams:void 0,toAck:a.map(function(a){return a.stanzaQueueId})}})}g.handleIncomingReceiptStanza=a}),98);
__d("IGDAttachmentUtils",["I64","LSAuthorityLevel","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,d){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=(yield a.attachments.get(b,e,f));(g==null?void 0:g.authorityLevel)!=null&&((h||(h=d("I64"))).to_int32(g.authorityLevel)===c("LSAuthorityLevel").AUTHORITATIVE_PENDING_REPLACEMENT||(h||(h=d("I64"))).to_int32(g.authorityLevel)===c("LSAuthorityLevel").CLIENT_PARTIAL)&&(yield a.attachments["delete"](b,e,f))});return i.apply(this,arguments)}g.deletePreliminaryAttachment=a}),98);
__d("IGDCOPInstructionsHandler",["IGDAWProtocolQueueInstructions","MAWIsQuotaExceededError","MAWSharedCOPLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing instructions batch, see transactor error reports."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["instruction consumer: ",""]);i=function(){return a};return a}function a(a){return j(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(i(),a);return[]})}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];var b=(yield d("IGDAWProtocolQueueInstructions").handleInstructions(a));b.toAck.length!==a.length&&c("MAWSharedCOPLogger").WARN(h());return b.toAck});return k.apply(this,arguments)}g["default"]=a}),98);
__d("InstamadilloStanzaDecoder",["FBLogger","InstamadilloTransportPayload.pb","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a.message.decrypted.type!=="InstamadilloMsg")return c("FBLogger")("igd_web_on_msgr").warn("InstamadilloStanzaDecoder: stanza is not of type InstamadilloMsg");var b=a.message.decrypted.msg.applicationPayload,e=null;try{e=d("decodeProtobuf").decodeProtobufWithUnknowns(d("InstamadilloTransportPayload.pb").TransportPayloadSpec,b)}catch(a){return c("FBLogger")("igd_web_on_msgr").catching(a).warn("InstamadilloStanzaDecoder: Failed to decode instamadillo stanza")}return{stanza:a,transportPayload:e}}g.decodeStanza=a}),98);
__d("IGDWEBUploadMessageUtils",["I64","MAWExtractMsFromExternalId","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] Could not extract ms from externalId: ",""]);i=function(){return a};return a}function a(a,b){var c=d("MAWExtractMsFromExternalId").extractMsFromExternalId((h||(h=d("I64"))).of_string(a));c==null&&d("WALogger").WARN(i(),a);return d("WATimeUtils").castToMillisTime(Number(b)*1e3+((a=c)!=null?a:0))}g.generateProtobufServerTs=a}),98);
__d("MSGDataclassTypes.flow",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";c=(a=b("$InternalEnum"))({HistoryRestore:"HISTORY_RESTORE",Reporting:"REPORTING",Fts:"FTS"});d=a({Before:"BEFORE",After:"AFTER"});e=a({UpsertBackupItem:"UPSERT_BACKUP_ITEM",RemoveBackupItem:"REMOVE_BACKUP_ITEM"});b=a({Message:"MESSAGE",Thread:"THREAD"});var g=a({Photo:"PHOTO",Permanent:"PERMANENT",Ephemeral:"EPHEMERAL",Video:"VIDEO",Gif:"GIF",Audio:"AUDIO",File:"FILE",Raven:"RAVEN",UnreadRaven:"UNREAD_RAVEN",ShareIgMedia:"SHARE_IG_MEDIA",ShareLink:"SHARE_LINK",ShareIgClips:"SHARE_IG_CLIPS",Shh:"SHH",StoryReply:"STORY_REPLY",DisappearingMessage:"DISAPPEARING_MESSAGE",RavenSeen:"RAVEN_SEEN",RavenReplayed:"RAVEN_REPLAYED",RavenReadOnce:"RAVEN_READ_ONCE",RavenReplayable:"RAVEN_REPLAYABLE",RavenPermanent:"RAVEN_PERMANENT"}),h=a({Fbn:"FBN",Instamadillo:"INSTAMADILLO",Unknown:"UNKNOWN"}),i=a({Retroactive:"RETROACTIVE",Realtime:"REALTIME"}),j=a({Success:"SUCCESS",RetryableException:"RETRYABLE_EXCEPTION",PermanentFailure:"PERMANENT_FAILURE"}),k=a({LlmOutput:"llm_output",SendQuery:"send_query",StartTyping:"start_typing",StopTyping:"stop_typing",VideoAboutToFinish:"video_about_to_finish"}),l=a({Love:"LOVE",Giftwrap:"GIFTWRAP",Celebration:"CELEBRATION",Fire:"FIRE",AvatarLove:"AVATAR_LOVE",AvatarAngry:"AVATAR_ANGRY",AvatarCry:"AVATAR_CRY",AvatarLaugh:"AVATAR_LAUGH"}),m=a({Reminder:"REMINDER",Subscription:"SUBSCRIPTION"}),n=a({Memu:"MEMU",Imagine:"IMAGINE"}),o=a({MagicModBackdrop:"MAGIC_MOD_BACKDROP",MagicModRestyle:"MAGIC_MOD_RESTYLE",Imagine:"IMAGINE",Memu:"MEMU"}),p=a({BanUser:"BAN_USER",RemoveUser:"REMOVE_USER",SuspendUser:"SUSPEND_USER",RemoveMessage:"REMOVE_MESSAGE",ReportMessage:"REPORT_MESSAGE",HideMessage:"HIDE_MESSAGE"}),q=a({MothersDay:"MOTHERS_DAY",FathersDay:"FATHERS_DAY",Graduation:"GRADUATION",NationalSelfie:"NATIONAL_SELFIE",PhIndependenceDay:"PH_INDEPENDENCE_DAY",JulyFourth:"JULY_FOURTH",FriendshipDay:"FRIENDSHIP_DAY"}),r=a({FbmInbox:"FBM_INBOX",Profile:"PROFILE",Feed:"FEED",Watch:"WATCH",Shorts:"SHORTS",Ufi:"UFI",Ctm:"CTM",Cts:"CTS",Psrib:"PSRIB",Srib:"SRIB",Rta:"RTA",Mp:"MP",CommentMentions:"COMMENT_MENTIONS",ZorroMessage:"ZORRO_MESSAGE",IgReels:"IG_REELS",IgStory:"IG_STORY",IgFeed:"IG_FEED",IgProfile:"IG_PROFILE",IgNotes:"IG_NOTES",IgLive:"IG_LIVE",IgExternalLink:"IG_EXTERNAL_LINK",IgComment:"IG_COMMENT",FbNotes:"FB_NOTES",FbGroups:"FB_GROUPS",GenAiSuggestedPrompts:"GEN_AI_SUGGESTED_PROMPTS",GenAiMultiModal:"GEN_AI_MULTI_MODAL",GenAiFlAshImagine:"GEN_AI_FlASH_IMAGINE",GenAiAssistant:"GEN_AI_ASSISTANT",Sharesheet:"SHARESHEET"}),s=a({Unspecified:"UNSPECIFIED",QuickEmoji:"QUICK_EMOJI",Avatar:"AVATAR",SuggestedReply:"SUGGESTED_REPLY"}),t=a({Default:"DEFAULT",CriticalUserMessage:"CRITICAL_USER_MESSAGE",NonCriticalAdminXma:"NON_CRITICAL_ADMIN_XMA"}),u=a({ThreadviewSuggestedPrompt:"THREADVIEW_SUGGESTED_PROMPT",TypeaheadSuggestedPrompt:"TYPEAHEAD_SUGGESTED_PROMPT",SuggestedPrompt:"SUGGESTED_PROMPT",NullStatePrompt:"NULL_STATE_PROMPT",UserInputPrompt:"USER_INPUT_PROMPT",GenericPrompt:"GENERIC_PROMPT"}),v=a({Mention:"MENTION",SuperReact:"SUPER_REACT",StoryReply:"STORY_REPLY",MessageReply:"MESSAGE_REPLY",ContentReply:"CONTENT_REPLY",ContentMention:"CONTENT_MENTION",ContentShare:"CONTENT_SHARE",OnPlatform:"ON_PLATFORM",OffPlatform:"OFF_PLATFORM",MessageForward:"MESSAGE_FORWARD",Avatar:"AVATAR",SocialSticker:"SOCIAL_STICKER",NoteReply:"NOTE_REPLY",InvokesGenAiResponse:"INVOKES_GEN_AI_RESPONSE",SentFromGenAiBot:"SENT_FROM_GEN_AI_BOT",DisappearingMessage:"DISAPPEARING_MESSAGE",IncludesOnPlatformContent:"INCLUDES_ON_PLATFORM_CONTENT",IncludesOffPlatformContent:"INCLUDES_OFF_PLATFORM_CONTENT",IncludesLink:"INCLUDES_LINK",MultitabEnv:"MULTITAB_ENV",PowerUp:"POWER_UP",MsysSend:"MSYS_SEND",EditMessage:"EDIT_MESSAGE",VanishMode:"VANISH_MODE",Superlative:"SUPERLATIVE",Raven:"RAVEN",Hotlike:"HOTLIKE",IsDialtone:"IS_DIALTONE",MessageReshare:"MESSAGE_RESHARE",PostReply:"POST_REPLY",IsNotDialtone:"IS_NOT_DIALTONE",ThirdPartyReshare:"THIRD_PARTY_RESHARE",ZeroBalanceDetected:"ZERO_BALANCE_DETECTED",ConversationStarter:"CONVERSATION_STARTER",AnimatedAiSticker:"ANIMATED_AI_STICKER",AiGeneratedSticker:"AI_GENERATED_STICKER",MagicModImage:"MAGIC_MOD_IMAGE",ShareOfOriginalUserContent:"SHARE_OF_ORIGINAL_USER_CONTENT",LightweightInteractionAsStoryReply:"LIGHTWEIGHT_INTERACTION_AS_STORY_REPLY",WriteWithMetaAi:"WRITE_WITH_META_AI"}),w=a({MsgrE2EeGenai:"MSGR_E2EE_GENAI"}),x=a({Imagine:"IMAGINE",Imaginev2:"IMAGINEV2",Imagineme:"IMAGINEME"}),y=a({Animate:"ANIMATE"}),z=a({Share:"SHARE",Reply:"REPLY",Mention:"MENTION",Bump:"BUMP"}),A=a({Statusupdate:"STATUSUPDATE",Grouppost:"GROUPPOST",Shareurl:"SHAREURL"}),B=a({Single:"SINGLE",Hscroll:"HSCROLL",Xcenter:"XCENTER",Portrait:"PORTRAIT",Layered:"LAYERED",Placeholder:"PLACEHOLDER",ExpiredPlaceholder:"EXPIRED_PLACEHOLDER",PilePrompt:"PILE_PROMPT",Stack:"STACK",SharedStack:"SHARED_STACK",StackCard:"STACK_CARD",StandardDxma:"STANDARD_DXMA",DxmaPlaceholder:"DXMA_PLACEHOLDER"}),C=a({Grid:"GRID",Hscroll:"HSCROLL",Portrait:"PORTRAIT",Single:"SINGLE",Vstack:"VSTACK",SharedStack:"SHARED_STACK"}),D=a({Left:"LEFT",Center:"CENTER"}),E=a({Test:"TEST",None:"NONE",IgMediaShare:"IG_MEDIA_SHARE",IgMultipostShare:"IG_MULTIPOST_SHARE",IgStoryReply:"IG_STORY_REPLY",IgStoryPhotoShare:"IG_STORY_PHOTO_SHARE",IgStoryPhotoMention:"IG_STORY_PHOTO_MENTION",IgClipsShare:"IG_CLIPS_SHARE",IgSingleVideoPostShare:"IG_SINGLE_VIDEO_POST_SHARE",IgStoryVideoShare:"IG_STORY_VIDEO_SHARE",IgStoryReaction:"IG_STORY_REACTION",IgIgtvShare:"IG_IGTV_SHARE",IgShopShare:"IG_SHOP_SHARE",IgProfileShare:"IG_PROFILE_SHARE",IgStoryPhotoHighlightShare:"IG_STORY_PHOTO_HIGHLIGHT_SHARE",IgStoryVideoHighlightShare:"IG_STORY_VIDEO_HIGHLIGHT_SHARE",IgStoryVideoMention:"IG_STORY_VIDEO_MENTION",IgStoryHighlightReply:"IG_STORY_HIGHLIGHT_REPLY",IgStoryHighlightReaction:"IG_STORY_HIGHLIGHT_REACTION",IgExternalLink:"IG_EXTERNAL_LINK",IgReceiverFetch:"IG_RECEIVER_FETCH",IgTextPostAppShare:"IG_TEXT_POST_APP_SHARE",FbFeedShare:"FB_FEED_SHARE",FbStoryReply:"FB_STORY_REPLY",FbStoryShare:"FB_STORY_SHARE",FbStoryMention:"FB_STORY_MENTION",FbFeedVideoShare:"FB_FEED_VIDEO_SHARE",FbGamingCustomUpdate:"FB_GAMING_CUSTOM_UPDATE",FbProducerStoryReply:"FB_PRODUCER_STORY_REPLY",FbEvent:"FB_EVENT",FbFeedPostPrivateReply:"FB_FEED_POST_PRIVATE_REPLY",FbShort:"FB_SHORT",FbCommentMentionShare:"FB_COMMENT_MENTION_SHARE",MsgExternalLinkShare:"MSG_EXTERNAL_LINK_SHARE",MsgP2PPayment:"MSG_P2P_PAYMENT",MsgLocationSharingDeprecated:"MSG_LOCATION_SHARING_DEPRECATED",MsgLocationSharingV2:"MSG_LOCATION_SHARING_V2",MsgReceiverFetch:"MSG_RECEIVER_FETCH",MsgIgMediaShare:"MSG_IG_MEDIA_SHARE",MsgGenAiSearchPluginResponse:"MSG_GEN_AI_SEARCH_PLUGIN_RESPONSE",MsgReelsList:"MSG_REELS_LIST",MsgContact:"MSG_CONTACT",MsgFile:"MSG_FILE",MsgAiContact:"MSG_AI_CONTACT",MsgMemoriesShare:"MSG_MEMORIES_SHARE",MsgEarlyAccessFbShare:"MSG_EARLY_ACCESS_FB_SHARE",MsgSharedAlbum:"MSG_SHARED_ALBUM",MsgReceiverFetchFallback:"MSG_RECEIVER_FETCH_FALLBACK",MsgAiBotSearchResult:"MSG_AI_BOT_SEARCH_RESULT",MsgGenAiSubscription:"MSG_GEN_AI_SUBSCRIPTION",MsgGenAi_1PSearchResult:"MSG_GEN_AI_1P_SEARCH_RESULT",RtcAudioCall:"RTC_AUDIO_CALL",RtcVideoCall:"RTC_VIDEO_CALL",RtcMissedAudioCall:"RTC_MISSED_AUDIO_CALL",RtcMissedVideoCall:"RTC_MISSED_VIDEO_CALL",RtcGroupAudioCall:"RTC_GROUP_AUDIO_CALL",RtcGroupVideoCall:"RTC_GROUP_VIDEO_CALL",RtcMissedGroupAudioCall:"RTC_MISSED_GROUP_AUDIO_CALL",RtcMissedGroupVideoCall:"RTC_MISSED_GROUP_VIDEO_CALL",LiveLocation:"LIVE_LOCATION",OcAvatarStaticSticker:"OC_AVATAR_STATIC_STICKER"}),F=a({XmaWebUrl:"XMA_WEB_URL",XmaOpenNative:"XMA_OPEN_NATIVE",XmaMsgExternalLinkShare:"XMA_MSG_EXTERNAL_LINK_SHARE",XmaGenAiSearchPluginResponseSources:"XMA_GEN_AI_SEARCH_PLUGIN_RESPONSE_SOURCES",XmaSharedAlbumViewer:"XMA_SHARED_ALBUM_VIEWER",XmaMetaAiSingleSubscription:"XMA_META_AI_SINGLE_SUBSCRIPTION",XmaMetaAiSubscriptions:"XMA_META_AI_SUBSCRIPTIONS",XmaMetaAiReminders:"XMA_META_AI_REMINDERS"}),G=a({Album:"ALBUM",Clips:"CLIPS",Video:"VIDEO"}),H=a({None:"NONE",VodVideo:"VOD_VIDEO",LiveVideo:"LIVE_VIDEO",ShortsVideo:"SHORTS_VIDEO"}),I=a({Default:"DEFAULT",ThreadsIcon:"THREADS_ICON",FacebookIcon:"FACEBOOK_ICON",ExternalLinkIcon:"EXTERNAL_LINK_ICON",MessengerIcon:"MESSENGER_ICON"}),J=a({Default:"DEFAULT"}),K=a({None:"NONE",Collage:"COLLAGE",Photo:"PHOTO",Video:"VIDEO",MultiPhoto:"MULTI_PHOTO",MessengerIcon:"MESSENGER_ICON",InstagramIcon:"INSTAGRAM_ICON",ReelsIcon:"REELS_ICON",Live:"LIVE",YoutubeVideo:"YOUTUBE_VIDEO",YoutubeShorts:"YOUTUBE_SHORTS",Blur:"BLUR",Pill:"PILL"}),L=a({Default:"DEFAULT",P2PPreviewImageWithTextOverlay:"P2P_PREVIEW_IMAGE_WITH_TEXT_OVERLAY",Playable:"PLAYABLE",AutoPlayable:"AUTO_PLAYABLE",BlurredImage:"BLURRED_IMAGE",BlurredPlayable:"BLURRED_PLAYABLE",InformTreatmentWithLabel:"INFORM_TREATMENT_WITH_LABEL",InformTreatmentWithWarningScreen:"INFORM_TREATMENT_WITH_WARNING_SCREEN",YoutubePlayer:"YOUTUBE_PLAYER",ImageWithPlayButton:"IMAGE_WITH_PLAY_BUTTON",Placeholder:"PLACEHOLDER",AutoPlayableWithAspectRatio:"AUTO_PLAYABLE_WITH_ASPECT_RATIO"}),M=a({Default:"DEFAULT",Rounded:"ROUNDED",BlurredCircle:"BLURRED_CIRCLE",TemplateAsset:"TEMPLATE_ASSET"}),N=a({MediaLabel:"MEDIA_LABEL",Misinformation:"MISINFORMATION",PostCover:"POST_COVER",PostLabel:"POST_LABEL",Private:"PRIVATE",Sensitive:"SENSITIVE",WarningScreens:"WARNING_SCREENS"}),O=a({None:"NONE",YoutubeVideo:"YOUTUBE_VIDEO",YoutubeShorts:"YOUTUBE_SHORTS"}),P=a({None:"NONE",Fb:"FB",FbAlwaysWhite:"FB_ALWAYS_WHITE",DotsThreeHorizontal:"DOTS_THREE_HORIZONTAL",ChevronDown:"CHEVRON_DOWN",FbInfoSmall:"FB_INFO_SMALL"}),Q=a({Weekly:"WEEKLY",Daily:"DAILY"}),R=a({Square:"SQUARE",Circle:"CIRCLE"});a=a({Chevron:"CHEVRON"});f.MpsQueryCaller=c;f.MpsMessageRangeQueryDirection=d;f.MpsBackupOperation=e;f.MpsBackupContentType=b;f.MpsMessageTag=g;f.MpsUploadType=h;f.MpsMessageBackupSource=i;f.MpsServerMessageUploadStatus=j;f.AiBotEmbodimentTrigger=k;f.XmsgPowerUpStyle=l;f.XmsgGenAiBotSubscriptionProductType=m;f.XmsgGenAiBotResponseProductType=n;f.XmsgaiProduct=o;f.XmsgSuggestedModerationActionType=p;f.XmsgHighlightsTabMoment=q;f.XmsgMessageSendProductType=r;f.XmsgStoryReplyType=s;f.GenAiContextInjectionType=t;f.GenAiPromptType=u;f.XmsgFeatureTags=v;f.XmsgMessageStreamingProductType=w;f.Xmsge2EeGenAiEncryptedImageProductType=x;f.Xmsge2EeGenAiEncryptedVideoProductType=y;f.XmsgMsgrXmaActionType=z;f.XmsgMsgrReceiverFetchContentType=A;f.XmsgMsgrReceiverFetchXmaLayoutType=B;f.XmsgXmaLayoutType=C;f.XmsgXmaVStackLayoutHeaderAlignmentType=D;f.XmsgXmaContentType=E;f.XmsgctaType=F;f.XmsgXmaContentAttributionIcon=G;f.XmsgXmaOverlayContentType=H;f.XmsgXmaSubtitleDecorationType=I;f.XmsgXmaVerifiedType=J;f.XmsgXmaImageDecorationType=K;f.XmsgXmaCustomPreviewType=L;f.XmsgXmaMessagingAttachmentFaviconStyle=M;f.XmsgXmaGatingType=N;f.XmsgXmaYoutubePreviewMediaType=O;f.XmsgXmaCtaIconType=P;f.XmsgXmaSubscriptionRecurrenceType=Q;f.XmsgXmaCompactGenericTemplatePreviewStyle=R;f.XmsgXmaCompactGenericTemplateAccessoryType=a}),66);
__d("generateEBUploadTags",["MSGDataclassTypes.flow"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){switch(a){case"text":case"like":return[];case"link":return[d("MSGDataclassTypes.flow").MpsMessageTag.ShareLink];case"xma_receiver_fetch":if((b==null?void 0:b.__typename)!=null)switch(b.__typename){case"XMSGIgReceiverFetchXmaFeedFetchParams":return[d("MSGDataclassTypes.flow").MpsMessageTag.ShareIgMedia,d("MSGDataclassTypes.flow").MpsMessageTag.ShareLink];case"XMSGIgReceiverFetchXmaProfileFetchParams":return[d("MSGDataclassTypes.flow").MpsMessageTag.ShareLink];case"XMSGIgReceiverFetchXmaClipFetchParams":return[d("MSGDataclassTypes.flow").MpsMessageTag.ShareIgMedia,d("MSGDataclassTypes.flow").MpsMessageTag.ShareLink,d("MSGDataclassTypes.flow").MpsMessageTag.ShareIgClips];case"XMSGIgReceiverFetchXmaStoryFetchParams":return[d("MSGDataclassTypes.flow").MpsMessageTag.StoryReply];case"XMSGIgReceiverFetchXmaLiveFetchParams":case"XMSGIgReceiverFetchXmaNoteFetchParams":return[];default:return[]}return[];case"media":switch(c){case"image":return[d("MSGDataclassTypes.flow").MpsMessageTag.Photo];case"gif":return[d("MSGDataclassTypes.flow").MpsMessageTag.Gif];case"sticker":return[d("MSGDataclassTypes.flow").MpsMessageTag.ShareLink];case"audio":return[d("MSGDataclassTypes.flow").MpsMessageTag.Audio,d("MSGDataclassTypes.flow").MpsMessageTag.Ephemeral];case"video":return[d("MSGDataclassTypes.flow").MpsMessageTag.Video]}return[];default:return[]}}g["default"]=a}),98);
__d("IGDGetMissingMediaFieldNames",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=Object.keys(a).filter(function(b){return a[b]==null});return b.join(", ")}f["default"]=a}),66);
__d("getInstamadilloMediaObjectIdsAndType",["$InternalEnum","FBLogger","IGDGetMissingMediaFieldNames","WAMediaUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=b("$InternalEnum")({IMAGE:"0",AUDIO:"1",VIDEO:"4",GIF:"5",STICKER:"6",XMA:"22",PREVIEW:"25"});function a(a){var b=[];a.forEach(function(a){if(a.staticPhoto!=null){var c;b.push({fileEncSha:(c=a.staticPhoto.mediaTransport)==null?void 0:c.fileEncSha256,fileSha:(c=a.staticPhoto.mediaTransport)==null?void 0:c.fileSha256,isPreview:!1,mediaKey:(c=a.staticPhoto.mediaTransport)==null?void 0:c.mediaKey,mediaObjectId:((c=a.staticPhoto.mediaTransport)==null?void 0:c.objectId)!=null?d("WAMediaUtils").stringToDeliveryObjectId((c=a.staticPhoto)==null?void 0:(c=c.mediaTransport)==null?void 0:c.objectId):void 0,mediaType:h.IMAGE,previewObjectId:((c=a.staticPhoto)==null?void 0:(c=c.thumbnail)==null?void 0:(c=c.mediaTransport)==null?void 0:c.objectId)!=null?d("WAMediaUtils").stringToDeliveryObjectId((c=a.staticPhoto)==null?void 0:(c=c.thumbnail)==null?void 0:(c=c.mediaTransport)==null?void 0:c.objectId):void 0});b.push({fileEncSha:(c=a.staticPhoto)==null?void 0:(c=c.thumbnail)==null?void 0:(c=c.mediaTransport)==null?void 0:c.fileEncSha256,fileSha:(c=a.staticPhoto)==null?void 0:(c=c.thumbnail)==null?void 0:(c=c.mediaTransport)==null?void 0:c.fileSha256,isPreview:!0,mediaKey:(c=a.staticPhoto)==null?void 0:(c=c.thumbnail)==null?void 0:(c=c.mediaTransport)==null?void 0:c.mediaKey,mediaObjectId:((c=a.staticPhoto)==null?void 0:(c=c.thumbnail)==null?void 0:(c=c.mediaTransport)==null?void 0:c.objectId)!=null?d("WAMediaUtils").stringToDeliveryObjectId((c=a.staticPhoto)==null?void 0:(c=c.thumbnail)==null?void 0:(c=c.mediaTransport)==null?void 0:c.objectId):void 0,mediaType:h.PREVIEW})}else if(a.voice!=null){b.push({fileEncSha:(c=a.voice)==null?void 0:(c=c.mediaTransport)==null?void 0:c.fileEncSha256,fileSha:(c=a.voice)==null?void 0:(c=c.mediaTransport)==null?void 0:c.fileSha256,isPreview:!1,mediaKey:(c=a.voice)==null?void 0:(c=c.mediaTransport)==null?void 0:c.mediaKey,mediaObjectId:((c=a.voice)==null?void 0:(c=c.mediaTransport)==null?void 0:c.objectId)!=null?d("WAMediaUtils").stringToDeliveryObjectId((c=a.voice)==null?void 0:(c=c.mediaTransport)==null?void 0:c.objectId):void 0,mediaType:h.AUDIO})}else if(a.video!=null){b.push({fileEncSha:(c=a.video)==null?void 0:(c=c.mediaTransport)==null?void 0:c.fileEncSha256,fileSha:(c=a.video)==null?void 0:(c=c.mediaTransport)==null?void 0:c.fileSha256,isPreview:!1,mediaKey:(c=a.video)==null?void 0:(c=c.mediaTransport)==null?void 0:c.mediaKey,mediaObjectId:((c=a.video)==null?void 0:(c=c.mediaTransport)==null?void 0:c.objectId)!=null?d("WAMediaUtils").stringToDeliveryObjectId((c=a.video)==null?void 0:(c=c.mediaTransport)==null?void 0:c.objectId):void 0,mediaType:h.VIDEO,previewObjectId:((c=a.video)==null?void 0:(c=c.thumbnail)==null?void 0:(c=c.mediaTransport)==null?void 0:c.objectId)!=null?d("WAMediaUtils").stringToDeliveryObjectId((c=a.video)==null?void 0:(c=c.thumbnail)==null?void 0:(c=c.mediaTransport)==null?void 0:c.objectId):void 0});b.push({fileEncSha:(c=a.video)==null?void 0:(c=c.thumbnail)==null?void 0:(c=c.mediaTransport)==null?void 0:c.fileEncSha256,fileSha:(c=a.video)==null?void 0:(c=c.thumbnail)==null?void 0:(c=c.mediaTransport)==null?void 0:c.fileSha256,isPreview:!0,mediaKey:(c=a.video)==null?void 0:(c=c.thumbnail)==null?void 0:(c=c.mediaTransport)==null?void 0:c.mediaKey,mediaObjectId:((c=a.video)==null?void 0:(c=c.thumbnail)==null?void 0:(c=c.mediaTransport)==null?void 0:c.objectId)!=null?d("WAMediaUtils").stringToDeliveryObjectId((c=a.video)==null?void 0:(c=c.thumbnail)==null?void 0:(c=c.mediaTransport)==null?void 0:c.objectId):void 0,mediaType:h.PREVIEW})}else if(a.gif!=null){b.push({fileEncSha:(c=a.gif)==null?void 0:(c=c.mediaTransport)==null?void 0:c.fileEncSha256,fileSha:(c=a.gif)==null?void 0:(c=c.mediaTransport)==null?void 0:c.fileSha256,isPreview:!1,mediaKey:(c=a.gif)==null?void 0:(c=c.mediaTransport)==null?void 0:c.mediaKey,mediaObjectId:((c=a.gif)==null?void 0:(c=c.mediaTransport)==null?void 0:c.objectId)!=null?d("WAMediaUtils").stringToDeliveryObjectId((c=a.gif)==null?void 0:(c=c.mediaTransport)==null?void 0:c.objectId):void 0,mediaType:((c=a.gif)==null?void 0:c.isSticker)===!0?h.STICKER:h.GIF})}else if(a.avatarSticker!=null){b.push({fileEncSha:(c=a.avatarSticker)==null?void 0:(c=c.mediaTransport)==null?void 0:c.fileEncSha256,fileSha:(c=a.avatarSticker)==null?void 0:(c=c.mediaTransport)==null?void 0:c.fileSha256,isPreview:!1,mediaKey:(c=a.avatarSticker)==null?void 0:(c=c.mediaTransport)==null?void 0:c.mediaKey,mediaObjectId:((c=a.avatarSticker)==null?void 0:(c=c.mediaTransport)==null?void 0:c.objectId)!=null?d("WAMediaUtils").stringToDeliveryObjectId((c=a.avatarSticker)==null?void 0:(a=c.mediaTransport)==null?void 0:a.objectId):void 0,mediaType:h.STICKER})}});return b.map(function(a){var b=a.fileEncSha,d=a.fileSha,e=a.isPreview,f=a.mediaKey,g=a.mediaObjectId,h=a.mediaType;a=a.previewObjectId;if(b!=null&&d!=null&&f!=null&&g!=null)return{fileEncSha:b,fileSha:d,isPreview:e,mediaKey:f,mediaObjectId:g,mediaType:h,previewObjectId:a};e===!1&&c("FBLogger")("labyrinth_web").warn("Missing media fields %s when getting Instamadillo media object",c("IGDGetMissingMediaFieldNames")({fileEncSha:b,fileSha:d,mediaKey:f,mediaObjectId:g,mediaType:h}));return}).filter(Boolean)}g["default"]=a}),98);
__d("addReceivedMessagesToEbUploadQueue",["FBLogger","I64","IGDWEBUploadMessageUtils","MAWEBSwitch","MAWSharedEbUploadQueue","MessageBackupSupplementalKeyGenerator","WAAsMessageApplication","WAGlobals","WAJids","WAStanzaUtils","generateEBUploadTags","getInstamadilloMediaObjectIdsAndType","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("ArmadilloReceiveWriteDbSuccessFalcoEvent").__setRef("addReceivedMessagesToEbUploadQueue"),j=c("requireDeferred")("EncryptedBackupTaskSkippedFalcoEvent").__setRef("addReceivedMessagesToEbUploadQueue");function k(a){a=(a=a.add)==null?void 0:(a=a.content)==null?void 0:a.receiverFetchXma;if(a!=null&&a.contentRef!=null){var b;try{b=JSON.parse(a.contentRef)}catch(a){c("FBLogger")("laybrinth_web").warn("Failed to parse receiverFetchXma.contentRef as JSON");return null}a=b;a=a.fetch_params;return a}return null}function l(a){var b;if((a==null?void 0:(b=a.supplement)==null?void 0:b.targetMessageOtid)!=null)return{externalId:d("WAStanzaUtils").toStanzaId(a.supplement.targetMessageOtid)};if((a==null?void 0:(b=a["delete"])==null?void 0:b.messageOtid)!=null){return{externalId:d("WAStanzaUtils").toStanzaId(a==null?void 0:(b=a["delete"])==null?void 0:b.messageOtid)}}c("FBLogger")("labyrinth_web").warn("Error getting originalMessageProtocolId for supplemental EB upload");return null}function m(a){if((a==null?void 0:a.add)!=null){var b;if(((b=a.add.content)==null?void 0:b.text)!=null)return"text";if(((b=a.add.content)==null?void 0:b.like)!=null)return"like";if(((b=a.add.content)==null?void 0:b.link)!=null)return"link";if(((b=a.add.content)==null?void 0:b.media)!=null)return"media";if(((b=a.add.content)==null?void 0:b.receiverFetchXma)!=null)return"xma_receiver_fetch"}if(a.supplement!=null){if(((b=a.supplement.content)==null?void 0:b.reaction)!=null||((b=a.supplement.content)==null?void 0:b.mediaReaction)!=null)return"reaction";if(((b=a.supplement.content)==null?void 0:b.editText)!=null)return"edit"}return a["delete"]!=null?"delete":"unknown"}function n(a,b,c){c=(h||(h=d("I64"))).to_string(c);switch(a){case"reaction":if(((a=b.supplement)==null?void 0:a.uniquingKeyForSupplementalData)!=null){return d("MessageBackupSupplementalKeyGenerator").createMessageSupplementalKey(d("MessageBackupSupplementalKeyGenerator").SupplementalKeyPrefix.REACTION,(a=b.supplement)==null?void 0:a.uniquingKeyForSupplementalData)}a=(a=b.supplement)==null?void 0:(a=a.content)==null?void 0:(a=a.mediaReaction)==null?void 0:a.mediaId;a=a!=null?c+":"+a:c;return d("MessageBackupSupplementalKeyGenerator").createMessageSupplementalKey(d("MessageBackupSupplementalKeyGenerator").SupplementalKeyPrefix.REACTION,a);case"edit":if(((a=b.supplement)==null?void 0:a.uniquingKeyForSupplementalData)!=null){return d("MessageBackupSupplementalKeyGenerator").createMessageSupplementalKey(d("MessageBackupSupplementalKeyGenerator").SupplementalKeyPrefix.EDIT,(a=b.supplement)==null?void 0:a.uniquingKeyForSupplementalData)}b=Date.now()+":"+c;return d("MessageBackupSupplementalKeyGenerator").createMessageSupplementalKey(d("MessageBackupSupplementalKeyGenerator").SupplementalKeyPrefix.EDIT,b);default:return}}function o(a){if(a==null)return;if(a.staticPhoto!=null)return"image";else if(a.video!=null)return"video";else if(a.voice!=null)return"audio";else if(a.raven)return;else if(a.gif!=null){return((a=a.gif)==null?void 0:a.isSticker)===!0?"sticker":"gif"}return}function a(a,b){var e,f,g=a.message.decrypted.id;e=(e=a.message.decrypted.msg)==null?void 0:e.applicationPayload;if(e==null||g==null){c("FBLogger")("labyrinth_web").warn("Unknown protocolId or empty transport payload while handling Instamadillo message for EB upload");return}var p=m(b);f=o((f=b.add)==null?void 0:(f=f.content)==null?void 0:f.media);var q=(h||(h=d("I64"))).of_string(d("WAJids").authorToUserId(g.author,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()))),r=b.openEb||!1;f=c("generateEBUploadTags")(p,k(b),f);switch(p){case"text":case"like":case"link":case"xma_receiver_fetch":c("promiseDone")(i.load(),function(a){return a.log(function(){return{encrypted_backup_enable:c("MAWEBSwitch").isEnabled(),message_id:g.externalId}})});return d("MAWSharedEbUploadQueue").putMsgsToEbUpload([{backupDirective:{actionType:1,originalMsgProtocolId:g},instamadilloItemId:d("IGDWEBUploadMessageUtils").generateProtobufServerTs(g.externalId,a.message.details.ts),isOpenEB:r,messageApplication:d("WAAsMessageApplication").castToMessageApplicationBytes(e),msgId:g,originalMsgProtocolId:g,reportingMeta:a.message.details.reportingMeta,senderId:q,serverTs:a.message.details.ts,tags:f}]);case"reaction":var s=n(p,b,q),t=l(b);if(t!=null&&s!=null){c("promiseDone")(i.load(),function(a){return a.log(function(){return{encrypted_backup_enable:c("MAWEBSwitch").isEnabled(),message_id:g.externalId}})});return d("MAWSharedEbUploadQueue").putMsgsToEbUpload([{backupDirective:{actionType:2,originalMsgProtocolId:t,supplementalKey:s},instamadilloItemId:d("IGDWEBUploadMessageUtils").generateProtobufServerTs(g.externalId,a.message.details.ts),isOpenEB:r,messageApplication:d("WAAsMessageApplication").castToMessageApplicationBytes(e),msgId:g,originalMsgProtocolId:t,reportingMeta:a.message.details.reportingMeta,senderId:q,serverTs:a.message.details.ts}])}c("promiseDone")(j.load(),function(a){return a.log(function(){return{message_id:g.externalId,skipped_reason:"missing_arguments"}})});c("FBLogger")("labyrinth_web").warn("Missing originalMsgProtocolId when putting to EB upload queue for a reaction message");break;case"edit":s=n(p,b,q);t=l(b);if(t!=null&&s!=null){c("promiseDone")(i.load(),function(a){return a.log(function(){return{encrypted_backup_enable:c("MAWEBSwitch").isEnabled(),message_id:g.externalId}})});return d("MAWSharedEbUploadQueue").putMsgsToEbUpload([{backupDirective:{actionType:2,originalMsgProtocolId:t,supplementalKey:s},instamadilloItemId:d("IGDWEBUploadMessageUtils").generateProtobufServerTs(g.externalId,a.message.details.ts),isOpenEB:r,messageApplication:d("WAAsMessageApplication").castToMessageApplicationBytes(e),msgId:g,originalMsgProtocolId:t,reportingMeta:a.message.details.reportingMeta,senderId:q,serverTs:a.message.details.ts}])}c("promiseDone")(j.load(),function(a){return a.log(function(){return{message_id:g.externalId,skipped_reason:"missing_arguments"}})});c("FBLogger")("labyrinth_web").warn("Missing originalMsgProtocolId when putting to EB upload queue for edit message");break;case"media":s=b==null?void 0:(s=b.add)==null?void 0:(t=s.content)==null?void 0:t.media;if(s!=null){t=c("getInstamadilloMediaObjectIdsAndType")([s]);s=t.some(function(a){return a.isPreview===!1});if(s){c("promiseDone")(i.load(),function(a){return a.log(function(){return{encrypted_backup_enable:c("MAWEBSwitch").isEnabled(),message_id:g.externalId}})});return d("MAWSharedEbUploadQueue").putMsgsToEbUpload([{attachmentContext:t,backupDirective:{actionType:1,originalMsgProtocolId:g},instamadilloItemId:d("IGDWEBUploadMessageUtils").generateProtobufServerTs(g.externalId,a.message.details.ts),isOpenEB:r,messageApplication:d("WAAsMessageApplication").castToMessageApplicationBytes(e),msgId:g,originalMsgProtocolId:g,reportingMeta:a.message.details.reportingMeta,senderId:q,serverTs:a.message.details.ts,tags:f}])}return c("FBLogger")("labyrinth_web").warn("Missing media fields when putting to EB upload queue for a sending a media message")}return c("FBLogger")("labyrinth_web").warn("Missing media field when putting to EB upload queue for a sending a media message");case"delete":s=l(b);if(s!=null){c("promiseDone")(i.load(),function(a){return a.log(function(){return{encrypted_backup_enable:c("MAWEBSwitch").isEnabled(),message_id:g.externalId}})});return d("MAWSharedEbUploadQueue").putMsgsToEbUpload([{backupDirective:{actionType:3,originalMsgProtocolId:s},instamadilloItemId:d("IGDWEBUploadMessageUtils").generateProtobufServerTs(g.externalId,a.message.details.ts),isOpenEB:r,messageApplication:d("WAAsMessageApplication").castToMessageApplicationBytes(e),msgId:g,originalMsgProtocolId:s,reportingMeta:a.message.details.reportingMeta,senderId:q,serverTs:a.message.details.ts}])}c("promiseDone")(j.load(),function(a){return a.log(function(){return{message_id:g.externalId,skipped_reason:"missing_arguments"}})});c("FBLogger")("labyrinth_web").warn("Missing originalMsgProtocolId when putting to EB upload queue for delete message");break;default:c("promiseDone")(j.load(),function(a){return a.log(function(){return{message_id:g.externalId,skipped_reason:"unsupported_message"}})});return c("FBLogger")("labyrinth_web").warn("Error handling Instamadillo message type for EB upload: %s",p)}}g["default"]=a}),98);
__d("isE2EEAttributedDM",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("qex")._("1437")===!0}g["default"]=a}),98);
__d("IGDEphemeralConstants",["WATimeUtils","isE2EEAttributedDM"],(function(a,b,c,d,e,f,g){"use strict";a=Math.imul(d("WATimeUtils").HOUR_SECONDS,6);b=a;e=d("WATimeUtils").DAY_SECONDS*14;f=c("isE2EEAttributedDM")()?b:e;g.oneDayInSeconds=d("WATimeUtils").DAY_SECONDS;g.sixHoursInSeconds=a;g.ephemeralReportingWindowInSeconds=f}),98);
__d("IGDMsgCleanerTxn",["FBLogger","I64","IGDEphemeralConstants","MAWReStoreDb","ODS","Promise","ReQL","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.edit_message_history.index("originalMsgPkEditTs"),["pk"]).getKeyRange(c)));c.length>0&&(yield (j||(j=b("Promise"))).allSettled(c.map(function(b){return a.edit_message_history["delete"](b.pk)})));return c.length});return function(b,c){return a.apply(this,arguments)}}();a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("MAWReStoreDb").getDB()),e=d("WATimeUtils").unixTime();e=(h||(h=d("I64"))).of_int32(d("WATimeUtils").pastUnixTime(d("IGDEphemeralConstants").ephemeralReportingWindowInSeconds,e));var f=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.messages.index("ephemeralExpirationTs"),["messageId","ephemeralExpirationTs","timestampMs","threadKey","editCount"]).bounds({lte:[e]})));return f.length===0?0:a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{yield (j||(j=b("Promise"))).all(f.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield a.messages["delete"](b.threadKey,b.timestampMs,b.messageId),b.editCount!=null&&(h||(h=d("I64"))).to_int32(b.editCount)>0&&(yield k(a,b.messageId))});return function(a){return c.apply(this,arguments)}}())),(i||(i=d("ODS"))).bumpEntityKey(938,"igd_dm_message_cleaner","delete_expired_messages_success")}catch(a){throw c("FBLogger")("igd_web_on_msgr").catching(a).mustfixThrow("Failed to delete messages in DM cleaner")}return f.length});return function(b){return a.apply(this,arguments)}}(),"readwrite","background")});return function(){return a.apply(this,arguments)}}();e=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("MAWReStoreDb").getDB()),b=d("WATimeUtils").unixTime();b=(h||(h=d("I64"))).of_int32(d("WATimeUtils").pastUnixTime(d("IGDEphemeralConstants").ephemeralReportingWindowInSeconds,b));a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.messages.index("ephemeralExpirationTs"),["ephemeralExpirationTs"]).bounds({gte:[b]}).map(function(a){a=a.ephemeralExpirationTs;return a?d("WATimeUtils").futureUnixTime(d("IGDEphemeralConstants").ephemeralReportingWindowInSeconds,d("WATimeUtils").castToUnixTime((h||(h=d("I64"))).to_int32(a))):void 0})));return a});return function(){return a.apply(this,arguments)}}();g.deleteExpiredEditMessageHistories=k;g.deleteExpiredMsgs=a;g.getNextMsgToDeleteTs=e}),98);
__d("IGDDisappearingMsgCleaner",["IGDMsgCleanerTxn","MAWLoggerUtils","MAWMsgCleaner","ODS","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["IGDDisappearingMsgCleaner: Adding timestamps ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["startIGDDisappearingMsgCleaner invoked"]);k=function(){return a};return a}var l=null;function a(){d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerStart]).LOG(k()),l==null&&(l=new(d("MAWMsgCleaner").MsgCleaner)({getNextTs:d("IGDMsgCleanerTxn").getNextMsgToDeleteTs,purgeEnabled:function(){return!0},removeExpired:d("IGDMsgCleanerTxn").deleteExpiredMsgs},d("MAWMsgCleaner").CLEANER_TYPE.IGDDM),(h||(h=d("ODS"))).bumpEntityKey(938,"igd_dm_message_cleaner","igd_dm_message_cleaner_initialized"))}function b(a){if(l!=null)l.update(a),d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerTimestamp]).DEV(j(),a);else{a="Trying to add new timestamp before the cleaner is initialized!";d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.MsgCleaner,d("MAWLoggerUtils").Tag.CleanerTimestamp]).DEV(i(),a)}}function c(){return l}function e(){l=null}g.startIGDDisappearingMsgCleaner=a;g.addNewDisappearingTimestamp=b;g.getIGDDisappearingMsgCleaner_FOR_TESTING_ONLY=c;g.resetIGDDisappearingMsgCleaner_FOR_TESTING_ONLY=e}),98);
__d("checkForExistingMessage",["InstamadilloMessageIdUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b=d("InstamadilloMessageIdUtils").getInstamadilloMessageIdFromProtocolMsgId(b);return a.tables.messages.index("messageId").get(b)}function b(a,b){b=d("InstamadilloMessageIdUtils").getInstamadilloMessageIdFromProtocolMsgId(b);return a.messages.index("messageId").get(b)}g.checkForExistingMessage=a;g.checkForExistingMessageForTxn=b}),98);
__d("handleInstamadilloAddMessageTextContent",["FBLogger","I64","InstamadilloMessageFactory","InstamadilloTextMessageUtils","LSAuthorityLevel","LSBitFlag","LSFactory","LSIntEnum","LSUpdateThreadSnippetFromLastMessageV2StoredProcedure","LSVerifyThreadRowExistsV2StoredProcedure","Promise","WAResultOrError","asyncToGeneratorRuntime","instamadilloBumpThread","instamadilloReplyMessageUtils","isStringNullOrEmpty"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b,c,d,e){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,k){g=g.text;if(c("isStringNullOrEmpty")(g)){c("FBLogger")("igd_web_on_msgr").warn("handleInstamadilloAddMessageTextContent: text message must not be empty");return(j||(j=b("Promise"))).resolve(d("WAResultOrError").makeResult({reason:"missing_required_arg",result:"skip"}))}k=(yield d("InstamadilloMessageFactory").createBaseMessageForProtocolMsgId(a,e,f,k));if(k==null)return d("WAResultOrError").makeResult({reason:"cannot_create_base_message",result:"skip"});var l=k.threadKey;yield c("LSVerifyThreadRowExistsV2StoredProcedure")(c("LSFactory")(a),{authorityLevel:(h||(h=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),syncGroup:(i||(i=d("I64"))).of_int32(1),threadKey:l,threadType:i.of_int32(1)});yield a.messages.put(babelHelpers["extends"]({},k,{displayedContentTypes:d("LSBitFlag").set(h.ofNumber(1),d("LSBitFlag").empty),text:g,textHasLinks:d("InstamadilloTextMessageUtils").textHasLinks(g),transportKey:"Instamadillo"}));yield d("instamadilloReplyMessageUtils").updateAllRepliesTxn(a,k.messageId);yield c("instamadilloBumpThread")(a,e,f);yield c("LSUpdateThreadSnippetFromLastMessageV2StoredProcedure")(c("LSFactory")(a),{threadKey:k.threadKey});return d("WAResultOrError").makeResult({result:"handled"})});return k.apply(this,arguments)}g["default"]=a}),98);
__d("handleInstamadilloAddMessageLikeContent",["PolarisDirectConstants","handleInstamadilloAddMessageTextContent"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g){f={$$unknownFieldCount:0,animatedEmojiCharacterRanges:[],commands:[],isSuggestedReply:!1,text:d("PolarisDirectConstants").DEFAULT_EMOJI_REACTION};return c("handleInstamadilloAddMessageTextContent")(a,b,e,f,g)}g["default"]=a}),98);
__d("IGDMediaManagement",["FBLogger","I64","MAWDbMedia","MAWDbMsg","MAWMediaUtils","Random","WAMediaUtils","WAParseConsumerMessageProtocol","WAPromiseQueue","WASortedLists","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new(d("WAPromiseQueue").PromiseQueue)();function a(a,e,f,g,j,k,l){var m=d("MAWDbMsg").stanzaIdToMsgId(e),n=j.objectId;if(n==null)return c("FBLogger")("igd_web_on_msgr").warn("Skip IGDMediaManagement: Missing objectId in mediaTransport");var o=(j==null?void 0:j.fileLength)!=null?j==null?void 0:j.fileLength:d("WAParseConsumerMessageProtocol").DEFAULT_FILE_SIZE,p=d("MAWMediaUtils").genHMACPlaintextHash(f);if(g.fileSha256==null||g.directPath==null||g.serverMediaType==null)return c("FBLogger")("igd_web_on_msgr").warn("Skip IGDMediaManagement: Missing essential mediaEntry fields");e=g.directPath;j=g.fileEncSha256;var q=g.fileSha256,r=g.mediaKey,s=g.mediaKeyTimestamp,t=g.objectId,u=g.serverMediaType;g=g.size;var v=d("WAMediaUtils").rawDataToMediaEntry({directPath:e,fileEncSha256:j,fileSha256:q,mediaKey:r,mediaKeyTimestamp:s,objectId:t,serverMediaType:u,size:g!=null?g:o});e=function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield a.e2ee_media.index("hashedPlaintextHash").get(p));try{if(b){var e=b.mediaEntries.set(m,v);e=babelHelpers["extends"]({},b,l,{mediaEntries:e,msgIds:d("WASortedLists").addToSet(b.msgIds,m)});yield a.e2ee_media.put(e)}else{e=new Map();e.set(m,v);var g=(h||(h=d("I64"))).of_float(d("Random").uint32());b=babelHelpers["extends"]({hashedPlaintextHash:p,mediaEntries:e,mediaId:d("MAWDbMedia").convertToMediaId64(g),mediaType:k,msgIds:d("WASortedLists").singleElement(m),objectId:d("WAMediaUtils").stringToDeliveryObjectId(n),plaintextHash:f,size:o,ts:d("WATimeUtils").unixTime()},l);yield a.e2ee_media.add(b)}return b.mediaId}catch(a){throw c("FBLogger")("igd_web_on_msgr").catching(a).mustfixThrow("IGDMediaManagement: Error writing media to db")}});return function(){return e.apply(this,arguments)}}();return i.enqueue(e)}g.writeIncomingMediaMsg=a}),98);
__d("IGDMediaUtils",["LSIntEnum","MessagingAttachmentType","WABase64","WAMediaCryptoSidecar","WAMediaUtils","WAServerMediaType","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c=a==null?void 0:a.fileSha256,e=a==null?void 0:a.fileEncSha256,f=a==null?void 0:a.mediaKey,g=a==null?void 0:a.directPath,h=a==null?void 0:a.mediaKeyTimestamp;b=d("WAServerMediaType").getMediaType(b);var i=a==null?void 0:a.objectId,j=a==null?void 0:a.fileLength;return c==null||e==null||f==null||g==null||h==null||b==null||i==null?null:{directPath:g,fbid:a==null?void 0:a.mediaId,fileEncSha256:d("WABase64").decodeB64((g=e)!=null?g:""),fileSha256:d("WABase64").decodeB64(c),mediaKey:d("WAMediaUtils").castToMediaKey(d("WABase64").decodeB64(f)),mediaKeyTimestamp:d("WATimeUtils").castToUnixTime(Number(h)),objectId:i,serverMediaType:b,sidecar:(a==null?void 0:a.sidecar)==null?void 0:d("WAMediaCryptoSidecar").castToStreamingSidecar(d("WABase64").decodeB64(a.sidecar)),size:j,uploadToken:void 0}}function b(a){a=(h||(h=d("LSIntEnum"))).unwrapIntEnum(a);switch(a){case c("MessagingAttachmentType").STICKER:return"Sticker";case c("MessagingAttachmentType").IMAGE:return"Image";case c("MessagingAttachmentType").ANIMATED_IMAGE:return"Gif";case c("MessagingAttachmentType").VIDEO:return"Video";case c("MessagingAttachmentType").FILE:return"DocumentFile";case c("MessagingAttachmentType").AUDIO:return"Ptt";case c("MessagingAttachmentType").NONE:case c("MessagingAttachmentType").XMA:case c("MessagingAttachmentType").EPHEMERAL_IMAGE:case c("MessagingAttachmentType").EPHEMERAL_VIDEO:case c("MessagingAttachmentType").SELFIE_STICKER:case c("MessagingAttachmentType").SOUND_BITE:case c("MessagingAttachmentType").CATALOG_ITEM:case c("MessagingAttachmentType").POWER_UP:case c("MessagingAttachmentType").THIRD_PARTY_STICKER:return null}}g.mediaTransportToDecodedMediaEntry=a;g.messagingAttachmentTypeToDbMediaType=b}),98);
__d("handleInstamadilloAddMessageLinkContent",["FBLogger","I64","IGDAttachmentUtils","IGDMediaManagement","IGDMediaUtils","InstamadilloMessageFactory","InstamadilloTextMessageUtils","LSAuthorityLevel","LSFactory","LSIntEnum","LSUpdateThreadSnippetFromLastMessageV2StoredProcedure","LSVerifyThreadRowExistsV2StoredProcedure","MAWExternalId","MessagingAttachmentType","Promise","WAHashUtils","WAMedia","WAResultOrError","WAStanzaUtils","asyncToGeneratorRuntime","instamadilloBumpThread","instamadilloReplyMessageUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=e.height,g=e.mediaTransport;e=e.width;if(g==null)throw c("FBLogger")("igd_web_on_msgr").warn("Missing mediaTransport for link thumbnail");var h=d("WAMedia").MEDIA_TYPE.IMAGE,i=g.fileSha256,j=d("IGDMediaUtils").mediaTransportToDecodedMediaEntry(g,h);if(i==null||j==null)throw c("FBLogger")("igd_web_on_msgr").warn("Missing plaintextHashString or mediaEntry for link thumbnail");a=(yield d("IGDMediaManagement").writeIncomingMediaMsg(a,d("WAStanzaUtils").toStanzaId(b),d("WAHashUtils").stringToPlaintextHash(i),j,g,h,{validatedAudioInfo:null,validatedDocumentFileInfo:null,validatedImageInfo:{height:f,width:e},validatedVideoInfo:null}));if(a==null)throw c("FBLogger")("igd_web_on_msgr").warn("Failed to write incoming media msg");return[a,j]});return l.apply(this,arguments)}function a(a,b,c,d,e){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,l){var m=g.text;if(m==null){c("FBLogger")("igd_web_on_msgr").warn("handleInstamadilloAddMessageLinkContent: text message must not be empty");return(j||(j=b("Promise"))).resolve(d("WAResultOrError").makeResult({reason:"missing_required_arg",result:"skip"}))}var n=function(){var j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b,j=(yield d("InstamadilloMessageFactory").createBaseMessageForProtocolMsgId(a,e,f,l));if(j==null)return d("WAResultOrError").makeResult({result:"skip"});var n=j.messageId,o=j.threadKey;yield c("LSVerifyThreadRowExistsV2StoredProcedure")(c("LSFactory")(a),{authorityLevel:(h||(h=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),syncGroup:(i||(i=d("I64"))).of_int32(1),threadKey:o,threadType:i.of_int32(1)});var p=d("InstamadilloMessageFactory").createBaseAttachment(e,f),q=(yield d("InstamadilloMessageFactory").createBaseAttachmentCta(e)),r=(yield d("InstamadilloMessageFactory").createBaseAttachmentItem(e));yield a.messages.put(babelHelpers["extends"]({},j,{displayedContentTypes:i.of_int32(1+1024+8),text:m,textHasLinks:d("InstamadilloTextMessageUtils").textHasLinks(m)}));var s=void 0,t=void 0;if(((b=g.linkContext)==null?void 0:b.linkPreviewThumbnail)!=null)try{b=(yield k(a,n,(b=g.linkContext)==null?void 0:b.linkPreviewThumbnail));t=b[0];s=b[1]}catch(a){return d("WAResultOrError").makeResult({result:"pending"})}yield d("IGDAttachmentUtils").deletePreliminaryAttachment(a,o,n,p.attachmentFbid);b=i.of_string(d("MAWExternalId").generateExternalId());b=babelHelpers["extends"]({},q,{actionUrl:(q=g==null?void 0:(n=g.linkContext)==null?void 0:n.linkUrl)!=null?q:"",ctaId:b,title:(q=g==null?void 0:(n=g.linkContext)==null?void 0:n.linkPreviewTitle)!=null?q:"",type_:"xma_web_url"});yield a.attachment_ctas.put(b);n=babelHelpers["extends"]({},p,{attachmentFbid:t!=null?(i||(i=d("I64"))).to_string(t):p.attachmentFbid,attachmentType:h.ofNumber(c("MessagingAttachmentType").XMA),defaultCtaId:b.ctaId,defaultCtaTitle:b.title,defaultCtaType:b.type_,hasXma:!0,isSharable:!0,subtitleText:(q=(n=g.linkContext)==null?void 0:n.linkSummary)!=null?q:"",titleText:(p=(t=g.linkContext)==null?void 0:t.linkPreviewTitle)!=null?p:""});yield a.attachments.put(n);yield a.attachment_items.put(babelHelpers["extends"]({},r,{defaultActionUrl:b.actionUrl,defaultCtaId:b.ctaId,defaultCtaTitle:b.title,defaultCtaType:b.type_,subtitleText:n.subtitleText,titleText:n.titleText}));yield d("instamadilloReplyMessageUtils").updateAllRepliesTxn(a,j.messageId);yield c("instamadilloBumpThread")(a,e,f);yield c("LSUpdateThreadSnippetFromLastMessageV2StoredProcedure")(c("LSFactory")(a),{threadKey:o});return d("WAResultOrError").makeResult(s)});return function(){return j.apply(this,arguments)}}();n=(yield n());if(n.success===!0){n=n.value;if((n==null?void 0:n.fileSha256)!=null)return d("WAResultOrError").makeResult({followUpParams:{decodedMediaEntry:n,protocolMsgId:e},result:"handled"})}return d("WAResultOrError").makeResult({result:"handled"})});return m.apply(this,arguments)}g["default"]=a}),98);
__d("handleInstamadilloAddMessageUnknownContent",["I64","IGDAttachmentUtils","InstamadilloMessageFactory","LSAuthorityLevel","LSBitFlag","LSFactory","LSIntEnum","LSUpdateThreadSnippetFromLastMessageV2StoredProcedure","LSVerifyThreadRowExistsV2StoredProcedure","WAResultOrError","asyncToGeneratorRuntime","instamadilloBumpThread"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c,d){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){f=(yield d("InstamadilloMessageFactory").createBaseMessageForProtocolMsgId(a,b,e,f));if(f==null)return d("WAResultOrError").makeResult({reason:"cannot_create_base_message",result:"skip"});var g=f.threadKey;yield c("LSVerifyThreadRowExistsV2StoredProcedure")(c("LSFactory")(a),{authorityLevel:(h||(h=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),syncGroup:(i||(i=d("I64"))).of_int32(1),threadKey:g,threadType:i.of_int32(1)});yield a.messages.put(babelHelpers["extends"]({},f,{displayedContentTypes:d("LSBitFlag").set(h.ofNumber(131072),d("LSBitFlag").empty)}));yield d("IGDAttachmentUtils").deletePreliminaryAttachment(a,g,f.messageId,b.externalId);yield c("LSUpdateThreadSnippetFromLastMessageV2StoredProcedure")(c("LSFactory")(a),{threadKey:g});yield c("instamadilloBumpThread")(a,b,e);return d("WAResultOrError").makeResult({result:"pending",type:"unknown"})});return j.apply(this,arguments)}g["default"]=a}),98);
__d("handleInstamadilloMediaContent",["FBLogger","I64","IGDAttachmentUtils","IGDMediaManagement","IGDMediaUtils","InstamadilloMessageFactory","LSAuthorityLevel","LSBitFlag","LSFactory","LSIntEnum","LSUpdateThreadSnippetFromLastMessageV2StoredProcedure","LSVerifyThreadRowExistsV2StoredProcedure","MessagingAttachmentType","WAHashUtils","WAResultOrError","WAStanzaUtils","asyncToGeneratorRuntime","instamadilloBumpThread","instamadilloReplyMessageUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=new Map([[(e=c("MessagingAttachmentType")).IMAGE,{displayedContentType:2,waMediaType:"Image"}],[e.VIDEO,{displayedContentType:2,waMediaType:"Video"}],[e.AUDIO,{displayedContentType:4,waMediaType:"Ptt"}],[e.EPHEMERAL_IMAGE,{displayedContentType:void 0,waMediaType:"Image"}],[e.EPHEMERAL_VIDEO,{displayedContentType:void 0,waMediaType:"Video"}],[e.STICKER,{displayedContentType:8,waMediaType:"Gif"}],[e.ANIMATED_IMAGE,{displayedContentType:8,waMediaType:"Gif"}]]);function a(a,b,c,d,e,f,g,h){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,k,l,m){if(g==null){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloMediaContent: Missing mediaTransport");return d("WAResultOrError").makeResult({reason:"missing_media_transport",result:"skip"})}var n=g.fileSha256,o=g.mimetype;if(n==null){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloMediaContent: Missing plaintextHashString");return d("WAResultOrError").makeResult({reason:"missing_media_plaintext_hash",result:"skip"})}var p=j.get(f);if(p==null){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloMediaContent: InferredMediaTypesMap is missing definitions for MessagingAttachmentTypeType %s",f);return d("WAResultOrError").makeResult({result:"pending"})}var q=d("IGDMediaUtils").mediaTransportToDecodedMediaEntry(g,p.waMediaType);if(q==null){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloStaticPhotoMediaContent: mediaEntry is missing essential data");return d("WAResultOrError").makeResult({reason:"missing_media_entry",result:"skip"})}l=(yield d("InstamadilloMessageFactory").createBaseMessageForProtocolMsgId(a,b,e,l));if(l==null)return d("WAResultOrError").makeResult({reason:"cannot_create_base_message",result:"skip"});var r=l.messageId,s=l.threadKey;n=(yield d("IGDMediaManagement").writeIncomingMediaMsg(a,d("WAStanzaUtils").toStanzaId(r),d("WAHashUtils").stringToPlaintextHash(n),q,g,p.waMediaType,k));if(n==null)return d("WAResultOrError").makeResult({reason:"missing_media_id",result:"skip"});yield c("LSVerifyThreadRowExistsV2StoredProcedure")(c("LSFactory")(a),{authorityLevel:(h||(h=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),syncGroup:(i||(i=d("I64"))).of_int32(1),threadKey:s,threadType:i.of_int32(1)});yield a.messages.put(babelHelpers["extends"]({},l,{displayedContentTypes:p.displayedContentType!=null?d("LSBitFlag").set((h||(h=d("LSIntEnum"))).ofNumber(p.displayedContentType),d("LSBitFlag").empty):d("LSBitFlag").empty}));g=d("InstamadilloMessageFactory").createBaseAttachment(b,e);yield d("IGDAttachmentUtils").deletePreliminaryAttachment(a,s,r,g.attachmentFbid);yield a.attachments.put(babelHelpers["extends"]({},g,{attachmentFbid:i.to_string(n),attachmentType:h.ofNumber(f),playableUrlMimeType:o,previewUrlMimeType:o},m));yield d("instamadilloReplyMessageUtils").updateAllRepliesTxn(a,l.messageId);yield c("instamadilloBumpThread")(a,b,e);yield c("LSUpdateThreadSnippetFromLastMessageV2StoredProcedure")(c("LSFactory")(a),{threadKey:s});return d("WAResultOrError").makeResult({decodedMediaEntry:q,result:"handled"})});return k.apply(this,arguments)}g["default"]=a}),98);
__d("handleInstamadilloGifMediaContent",["FBLogger","I64","MessagingAttachmentType","Promise","WAResultOrError","handleInstamadilloMediaContent"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,e,f,g,j){var k=g.height,l=g.isSticker,m=g.mediaTransport;g=g.width;if(m==null){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloGifMediaContent: Missing mediaTransport");return(i||(i=b("Promise"))).resolve(d("WAResultOrError").makeResult({reason:"missing_media_transport",result:"skip"}))}var n={validatedAudioInfo:null,validatedDocumentFileInfo:null,validatedImageInfo:{height:k,width:g},validatedVideoInfo:null};l=l===!0?c("MessagingAttachmentType").STICKER:c("MessagingAttachmentType").ANIMATED_IMAGE;return c("handleInstamadilloMediaContent")(a,e,f,l,m,n,j,{hasMedia:!0,hasXma:!1,previewHeight:(h||(h=d("I64"))).of_int32((a=k)!=null?a:0),previewWidth:h.of_int32((e=g)!=null?e:0),shouldAutoplayVideo:!0})}g["default"]=a}),98);
__d("handleInstamadilloStaticPhotoMediaContent",["FBLogger","I64","MessagingAttachmentType","Promise","WAResultOrError","handleInstamadilloMediaContent"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,e,f,g,j,k){var l=g.height,m=g.mediaTransport;g=g.width;if(m==null){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloStaticPhotoMediaContent: Missing mediaTransport");return(i||(i=b("Promise"))).resolve(d("WAResultOrError").makeResult({reason:"missing_media_transport",result:"skip"}))}var n={validatedAudioInfo:null,validatedDocumentFileInfo:null,validatedImageInfo:{height:l,width:g},validatedVideoInfo:null},o=c("MessagingAttachmentType").IMAGE;k!=null&&(o=c("MessagingAttachmentType").EPHEMERAL_IMAGE);return c("handleInstamadilloMediaContent")(a,e,f,o,m,n,j,babelHelpers["extends"]({previewHeight:(h||(h=d("I64"))).of_int32((a=l)!=null?a:0),previewWidth:h.of_int32((e=g)!=null?e:0)},k))}g["default"]=a}),98);
__d("handleInstamadilloVideoMediaContent",["FBLogger","I64","MessagingAttachmentType","Promise","WAResultOrError","handleInstamadilloMediaContent"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,e,f,g,j,k){var l=g.height,m=g.mediaTransport;g=g.width;if(m==null){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloVideoMediaContent: Missing mediaTransport");return(i||(i=b("Promise"))).resolve(d("WAResultOrError").makeResult({reason:"missing_media_transport",result:"skip"}))}var n={validatedAudioInfo:null,validatedDocumentFileInfo:null,validatedImageInfo:null,validatedVideoInfo:{height:l,width:g}},o=c("MessagingAttachmentType").VIDEO;k!=null&&(o=c("MessagingAttachmentType").EPHEMERAL_VIDEO);return c("handleInstamadilloMediaContent")(a,e,f,o,m,n,j,babelHelpers["extends"]({previewHeight:(h||(h=d("I64"))).of_int32((a=l)!=null?a:0),previewWidth:h.of_int32((e=g)!=null?e:0)},k))}g["default"]=a}),98);
__d("handleInstamadilloRavenMediaContent",["EphemeralMediaViewMode","FBLogger","I64","InstamadilloCoreTypeMedia.pb","LSIntEnum","Promise","RavenMessagingState","WAResultOrError","WATimeUtils","handleInstamadilloStaticPhotoMediaContent","handleInstamadilloVideoMediaContent"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a){switch(a){case d("InstamadilloCoreTypeMedia.pb").RAVEN_VIEW_MODE.RAVEN_VIEW_MODEL_PERMANENT:return c("EphemeralMediaViewMode").PERMANENT;case d("InstamadilloCoreTypeMedia.pb").RAVEN_VIEW_MODE.RAVEN_VIEW_MODEL_ONCE:return c("EphemeralMediaViewMode").READ_ONCE;case d("InstamadilloCoreTypeMedia.pb").RAVEN_VIEW_MODE.RAVEN_VIEW_MODEL_REPLAYABLE:return c("EphemeralMediaViewMode").REPLAYABLE;case d("InstamadilloCoreTypeMedia.pb").RAVEN_VIEW_MODE.RAVEN_VIEW_MODEL_UNSPECIFIED:default:return null}}function a(a,e,f,g,l){var m=k(g.viewMode);if(m==null){c("FBLogger")("igd_web_on_msgr").warn("handleInstmadilloRavenMediaContent: Unknown view mode %s",g.viewMode);return(j||(j=b("Promise"))).resolve(d("WAResultOrError").makeResult({result:"pending"}))}var n=(h||(h=d("I64"))).of_int32(24*3600*1e3),o=h.of_float(d("WATimeUtils").unixTime()*1e3);n=h.add(f,n);o=h.gt(o,n);n={ephemeralMediaState:(i||(i=d("LSIntEnum"))).ofNumber(o?c("RavenMessagingState").EXPIRED:c("RavenMessagingState").UNSEEN),ephemeralMediaViewMode:i.ofNumber(m)};if((g==null?void 0:(o=g.content)==null?void 0:o.staticPhoto)!=null)return c("handleInstamadilloStaticPhotoMediaContent")(a,e,f,g.content.staticPhoto,l,n);else if((g==null?void 0:(m=g.content)==null?void 0:m.video)!=null)return c("handleInstamadilloVideoMediaContent")(a,e,f,g.content.video,l,n);return(j||(j=b("Promise"))).resolve(d("WAResultOrError").makeResult({result:"pending"}))}g["default"]=a}),98);
__d("handleInstamadilloVoiceMediaContent",["FBLogger","I64","MessagingAttachmentType","Promise","WAResultOrError","handleInstamadilloMediaContent"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,e,f,g,j){var k=g.duration,l=g.mediaTransport,m=g.waveforms;g=g.waveformSamplingFrequencyHz;if(l==null){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloVideoMediaContent: Missing mediaTransport");return(i||(i=b("Promise"))).resolve(d("WAResultOrError").makeResult({reason:"missing_required_arg",result:"skip"}))}var n={validatedAudioInfo:{duration:k||0,mimetype:l==null?void 0:l.mimetype},validatedDocumentFileInfo:null,validatedImageInfo:null,validatedVideoInfo:null};return c("handleInstamadilloMediaContent")(a,e,f,c("MessagingAttachmentType").AUDIO,l,n,j,{playableDurationMs:(h||(h=d("I64"))).of_int32((a=k)!=null?a:0),samplingFrequencyHz:h.of_int32((e=g)!=null?e:0),waveformData:m!=null?m.join(","):""})}g["default"]=a}),98);
__d("handleInstamadilloAddMessageMediaContent",["WAResultOrError","asyncToGeneratorRuntime","handleInstamadilloAddMessageUnknownContent","handleInstamadilloGifMediaContent","handleInstamadilloRavenMediaContent","handleInstamadilloStaticPhotoMediaContent","handleInstamadilloVideoMediaContent","handleInstamadilloVoiceMediaContent"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,d,e){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){var h;f.staticPhoto!=null?h=(yield c("handleInstamadilloStaticPhotoMediaContent")(a,b,e,f.staticPhoto,g)):f.video!=null?h=(yield c("handleInstamadilloVideoMediaContent")(a,b,e,f.video,g)):f.voice!=null?h=(yield c("handleInstamadilloVoiceMediaContent")(a,b,e,f.voice,g)):f.raven?h=(yield c("handleInstamadilloRavenMediaContent")(a,b,e,f.raven,g)):f.gif!=null&&(h=(yield c("handleInstamadilloGifMediaContent")(a,b,e,f.gif,g)));if(((f=h)==null?void 0:f.success)===!0)switch(h.value.result){case"skip":return d("WAResultOrError").makeResult(h.value);case"pending":return d("WAResultOrError").makeResult({result:"pending",type:"add"});case"handled":f=h.value.decodedMediaEntry;if(f.fileSha256!=null)return d("WAResultOrError").makeResult({followUpParams:{decodedMediaEntry:f,protocolMsgId:b},result:"handled"})}return c("handleInstamadilloAddMessageUnknownContent")(a,b,e,g)});return h.apply(this,arguments)}g["default"]=a}),98);
__d("handleInstamadilloReceiverFetchLive",["I64","InstamadilloLiveReplySnippet","InstamadilloReceiverFetchAttachmentRowOverride","LSIntEnum","LSMessageReplySourceTypeV2","handleInstamadilloReceiverFetchContent"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,e,f,g,j,k){var l=g.target_url,m=j.live_igid,n;l!=null&&l!==""&&(n={actionUrl:l,nativeUrl:l,targetId:(h||(h=d("I64"))).of_string(m),type_:"xma_web_url"});return c("handleInstamadilloReceiverFetchContent")(a,b,e,f,j,k,d("InstamadilloReceiverFetchAttachmentRowOverride").getAttachmentRowOverride(j.__typename,g.username),n,{replySnippet:d("InstamadilloLiveReplySnippet").getMessageReplySnippetForLive(g.username),replySourceTypeV2:(i||(i=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceTypeV2").XMA)})}g["default"]=a}),98);
__d("handleInstamadilloReceiverFetchNote",["I64","InstamadilloNoteReplySnippet","InstamadilloReceiverFetchAttachmentRowOverride","LSIntEnum","LSMessageReplySourceTypeV2","handleInstamadilloReceiverFetchContent"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,e,f,g,j,k){var l=g.target_url,m=j.note_igid,n;l!=null&&l!==""&&(n={actionUrl:l,nativeUrl:l,targetId:(h||(h=d("I64"))).of_string(m),type_:"xma_web_url"});return c("handleInstamadilloReceiverFetchContent")(a,b,e,f,j,k,d("InstamadilloReceiverFetchAttachmentRowOverride").getAttachmentRowOverride(j.__typename,g.username),n,{replySnippet:d("InstamadilloNoteReplySnippet").getNoteReplySnippet(b.author),replySourceTypeV2:(i||(i=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceTypeV2").IG_NOTE)})}g["default"]=a}),98);
__d("handleInstamadilloReceiverFetchPost",["I64","IGDDataclassTypes.flow","InstamadilloPostReplySnippet","InstamadilloReceiverFetchAttachmentRowOverride","LSIntEnum","LSMessageReplySourceTypeV2","WAJids","asyncToGeneratorRuntime","handleInstamadilloReceiverFetchContent"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c,d,e,f,g){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,j,k){var l=g.target_url,m=j.media_igid,n;l!=null&&l!==""&&(n={actionUrl:l,nativeUrl:l,targetId:(h||(h=d("I64"))).of_string(m),type_:"igd_web_post_share"});l={};if(g.action_type===d("IGDDataclassTypes.flow").XmsgIgXmaActionType.Mention){m=d("WAJids").threadIdForChatJid(b.chat);m=(yield a.contacts.get((h||(h=d("I64"))).of_string(m)));l={replySnippet:d("InstamadilloPostReplySnippet").getMessageReplySnippetForPost(b.author,m==null?void 0:m.name),replySourceTypeV2:(i||(i=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceTypeV2").XMA)}}return c("handleInstamadilloReceiverFetchContent")(a,b,e,f,j,k,d("InstamadilloReceiverFetchAttachmentRowOverride").getAttachmentRowOverride(j.__typename,g.username),n,l)});return j.apply(this,arguments)}g["default"]=a}),98);
__d("handleInstamadilloReceiverFetchProfile",["I64","InstamadilloReceiverFetchAttachmentRowOverride","handleInstamadilloReceiverFetchContent"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e,f,g,i,j){var k=g.target_url,l=i.igid,m;k!=null&&k!==""&&(m={actionUrl:k,nativeUrl:k,targetId:(h||(h=d("I64"))).of_string(l),type_:"xma_web_url"});return c("handleInstamadilloReceiverFetchContent")(a,b,e,f,i,j,d("InstamadilloReceiverFetchAttachmentRowOverride").getAttachmentRowOverride(i.__typename,g.username),m)}g["default"]=a}),98);
__d("handleInstamadilloReceiverFetchReel",["I64","InstamadilloReceiverFetchAttachmentRowOverride","handleInstamadilloReceiverFetchContent"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e,f,g,i,j){var k=g.target_url,l=i.media_igid,m;k!=null&&(m={actionUrl:k,nativeUrl:k,targetId:(h||(h=d("I64"))).of_string(l),type_:"igd_web_post_share"});return c("handleInstamadilloReceiverFetchContent")(a,b,e,f,i,j,d("InstamadilloReceiverFetchAttachmentRowOverride").getAttachmentRowOverride(i.__typename,g.username),m)}g["default"]=a}),98);
__d("handleInstamadilloReceiverFetchStory",["I64","InstamadilloReceiverFetchAttachmentRowOverride","InstamadilloStoryReplySnippet","LSIntEnum","LSMessageReplySourceTypeV2","WAJids","asyncToGeneratorRuntime","handleInstamadilloReceiverFetchContent"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c,d,e,f,g){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,j,k){var l=g.target_url,m=j.story_igid,n;l!=null&&l!==""&&(n={actionUrl:l,nativeUrl:l,targetId:(h||(h=d("I64"))).of_string(m),type_:"xma_web_url"});l=d("WAJids").threadIdForChatJid(b.chat);m=(yield a.contacts.get((h||(h=d("I64"))).of_string(l)));return c("handleInstamadilloReceiverFetchContent")(a,b,e,f,j,k,d("InstamadilloReceiverFetchAttachmentRowOverride").getAttachmentRowOverride(j.__typename,g.username),n,{replySnippet:(l=d("InstamadilloStoryReplySnippet").getMessageReplySnippetForStory(b.author,g,m==null?void 0:m.name))!=null?l:void 0,replySourceTypeV2:(i||(i=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceTypeV2").IG_STORY_SHARE)})});return j.apply(this,arguments)}g["default"]=a}),98);
__d("handleInstamadilloAddMessageReceiverFetchXmaContent",["ConstUriUtils","FBLogger","IGDXMAUtils","Promise","WAResultOrError","handleInstamadilloAddMessageUnknownContent","handleInstamadilloReceiverFetchLive","handleInstamadilloReceiverFetchNote","handleInstamadilloReceiverFetchPost","handleInstamadilloReceiverFetchProfile","handleInstamadilloReceiverFetchReel","handleInstamadilloReceiverFetchStory","isStringNullOrEmpty"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,e,f,g,i){var j;if(g.contentRef==null)return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult({reason:"missing_required_arg",result:"skip"}));var k;try{k=JSON.parse(g.contentRef)}catch(a){c("FBLogger")("igd_web_on_msgr").warn("Failed to parse receiverFetchXma.contentRef as JSON");return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult({reason:"cannot_parse_content_ref_json",result:"skip"}))}var l=k;l=l.fetch_params;if(l==null)return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult({reason:"missing_required_arg",result:"skip"}));j=d("ConstUriUtils").getUri((j=k.target_url)!=null?j:"");j=d("IGDXMAUtils").isInstagramDomain(j);if(!c("isStringNullOrEmpty")(k.target_url)&&!j)return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult({reason:"invalid_target_url",result:"skip"}));switch(l.__typename){case"XMSGIgReceiverFetchXmaLiveFetchParams":return c("handleInstamadilloReceiverFetchLive")(a,e,f,g,k,l,i);case"XMSGIgReceiverFetchXmaNoteFetchParams":return c("handleInstamadilloReceiverFetchNote")(a,e,f,g,k,l,i);case"XMSGIgReceiverFetchXmaFeedFetchParams":return c("handleInstamadilloReceiverFetchPost")(a,e,f,g,k,l,i);case"XMSGIgReceiverFetchXmaProfileFetchParams":return c("handleInstamadilloReceiverFetchProfile")(a,e,f,g,k,l,i);case"XMSGIgReceiverFetchXmaClipFetchParams":return c("handleInstamadilloReceiverFetchReel")(a,e,f,g,k,l,i);case"XMSGIgReceiverFetchXmaStoryFetchParams":return c("handleInstamadilloReceiverFetchStory")(a,e,f,g,k,l,i);default:return c("handleInstamadilloAddMessageUnknownContent")(a,e,f)}}g["default"]=a}),98);
__d("handleInstamadilloAddMessagePayload",["FBLogger","I64","InstamadilloMessageFactory","LSAuthorityLevel","WAResultOrError","asyncToGeneratorRuntime","checkForExistingMessage","gkx","handleInstamadilloAddMessageLikeContent","handleInstamadilloAddMessageLinkContent","handleInstamadilloAddMessageMediaContent","handleInstamadilloAddMessageReceiverFetchXmaContent","handleInstamadilloAddMessageTextContent","handleInstamadilloAddMessageUnknownContent","instamadilloReplyMessageUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,d){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=(yield d("checkForExistingMessage").checkForExistingMessageForTxn(a,b));if(g!=null&&(h||(h=d("I64"))).to_int32(g.authorityLevel)!==c("LSAuthorityLevel").AUTHORITATIVE_PENDING_REPLACEMENT&&(h||(h=d("I64"))).to_int32(g.authorityLevel)!==c("LSAuthorityLevel").CLIENT_PARTIAL){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloAddMessagePayload: message already handled & exists locally");return d("WAResultOrError").makeResult({reason:"message_already_exists",result:"skip"})}if(f.content==null){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloAddMessagePayload: Missing content in add message payload");return d("WAResultOrError").makeResult({reason:"missing_required_arg",result:"skip"})}g=f.content;f=f.metadata;var i=d("InstamadilloMessageFactory").getThreadAndMessageId(b);i=i.threadKey;yield d("instamadilloReplyMessageUtils").fetchReplySourceMessage(a,i,f==null?void 0:f.repliedToMessage);if(g.text!=null)return c("handleInstamadilloAddMessageTextContent")(a,b,e,g.text,f);else if(g.like!=null)return c("handleInstamadilloAddMessageLikeContent")(a,b,e,g.like,f);else if(g.link!=null)return c("handleInstamadilloAddMessageLinkContent")(a,b,e,g.link,f);else if(g.media!=null){i=g.media;if(c("gkx")("2226"))return c("handleInstamadilloAddMessageMediaContent")(a,b,e,i,f)}else if(g.receiverFetchXma!=null)return c("handleInstamadilloAddMessageReceiverFetchXmaContent")(a,b,e,g.receiverFetchXma,f);return c("handleInstamadilloAddMessageUnknownContent")(a,b,e,f)});return i.apply(this,arguments)}g["default"]=a}),98);
__d("updateInstamadilloDeleteMessageAfterSendingOrReceiving",["I64","IGDMsgCleanerTxn","InstamadilloReplyMessageParams","LSFactory","LSUpdateThreadSnippetFromLastMessageV2StoredProcedure","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){yield a.messages["delete"](e.threadKey,e.timestampMs,e.messageId);var f=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.messages.index("replySourceIdMessageID")).getKeyRange(e.messageId)));f.length>0&&(yield (i||(i=b("Promise"))).all(f.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=babelHelpers["extends"]({},b,d("InstamadilloReplyMessageParams").getEmptyReplyMessageParams());yield a.messages.upsert([b.threadKey,b.timestampMs,b.messageId],c)});return function(a){return c.apply(this,arguments)}}())));e.editCount!=null&&(h||(h=d("I64"))).to_int32(e.editCount)>0&&(yield d("IGDMsgCleanerTxn").deleteExpiredEditMessageHistories(a,e.messageId));yield c("LSUpdateThreadSnippetFromLastMessageV2StoredProcedure")(c("LSFactory")(a),{threadKey:e.threadKey})});return k.apply(this,arguments)}function a(a,b){return a.runInTransaction(function(a){return j(a,b)},"readwrite",void 0,void 0,f.id+":75")}g.updateInstamadilloDeleteMessageAfterSendingOrReceivingForTxn=j;g.updateInstamadilloDeleteMessageAfterSendingOrReceiving=a}),98);
__d("handleInstamadilloDeleteMessagePayload",["FBLogger","I64","InstamadilloMessageIdUtils","MAWAuthor","WAJids","WAResultOrError","asyncToGeneratorRuntime","updateInstamadilloDeleteMessageAfterSendingOrReceiving"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){e=e.messageOtid;if(e==null){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloDeleteMessagePayload: null messageOtid cannot be deleted");return d("WAResultOrError").makeResult({reason:"missing_required_arg",result:"skip"})}var f=d("MAWAuthor").getAuthorUserJid(b.author);if(f==null){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloDeleteMessagePayload: authorJid should not be null or undefined");return d("WAResultOrError").makeResult({reason:"missing_author",result:"skip"})}b=d("WAJids").threadIdForChatJid(b.chat);b=(h||(h=d("I64"))).of_string(b);b=d("InstamadilloMessageIdUtils").toInstamadilloMessageId(b,e);e=(yield a.messages.index("messageId").get(b));if(e==null){c("FBLogger")("igd_web_on_msgr").info("handleInstamadilloDeleteMessagePayload: tried to receive retrieve to a message that does not exist locally");return d("WAResultOrError").makeResult({result:"pending",targetMessageId:b,type:"delete"})}b=h.of_string(d("WAJids").userIdFromJid(f));if(!(h||(h=d("I64"))).equal(b,e.senderId)){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloDeleteMessagePayload: Only message owner can authoritatively delete their own message");return d("WAResultOrError").makeResult({reason:"unauthorized_sender",result:"skip"})}yield d("updateInstamadilloDeleteMessageAfterSendingOrReceiving").updateInstamadilloDeleteMessageAfterSendingOrReceivingForTxn(a,e);return d("WAResultOrError").makeResult({isDM:e.ephemeralDurationInSec!=null||e.ephemeralExpirationTs!=null,result:"handled"})});return i.apply(this,arguments)}g["default"]=a}),98);
__d("handleInstamadilloSupplementMessageEditTextContent",["FBLogger","I64","LSFactory","LSIntEnum","LSMessageSendStatus","LSUpdateThreadSnippetFromLastMessageV2StoredProcedure","MAWAuthor","Promise","ReQL","WAJids","WAResultOrError","asyncToGeneratorRuntime","getIsMessageTimeBelowEditThreshold"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b,c,d,e){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,k){e=d("MAWAuthor").getAuthorUserJid(e.author);if(e==null){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloSupplementMessageEditTextContent: authorJid should not be null or undefined");return d("WAResultOrError").makeResult({reason:"missing_author",result:"skip"})}e=(i||(i=d("I64"))).of_string(d("WAJids").userIdFromJid(e));if(!(i||(i=d("I64"))).equal(e,k.senderId)){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloSupplementMessageEditTextContent: Only message owner can edit their own message");return d("WAResultOrError").makeResult({reason:"unauthorized_sender",result:"skip"})}e=d("getIsMessageTimeBelowEditThreshold").getIsMessageTimeBelowEditThreshold(f,k.timestampMs);if(!e)return d("WAResultOrError").makeResult({reason:"passed_supplement_message_timestamp_threshold",result:"skip"});e=k.messageId;var l=k.threadKey,m=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.edit_message_history.index("originalMsgPkEditTs")).getKeyRange(e)));m==null&&(yield a.edit_message_history.add({messageContent:k.text,originalMessagePk:e,sendStatus:(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").SERVER_RECEIVED),serverAdjustedEditTsMs:k.timestampMs,threadKey:l}));m={messageContent:g.newContent,originalMessagePk:e,sendStatus:(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").SERVER_RECEIVED),serverAdjustedEditTsMs:f,threadKey:l};yield a.edit_message_history.put(m);m=babelHelpers["extends"]({},k,{editCount:i.of_int32((f=g.editCount)!=null?f:0),text:g.newContent});yield a.messages.put(m);f=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.messages.index("replySourceIdMessageID")).getKeyRange(e)));m=f.map(function(b){b=babelHelpers["extends"]({},b,{replyMessageText:g.newContent});return a.messages.put(b)});yield (h||(h=b("Promise"))).all(m);yield c("LSUpdateThreadSnippetFromLastMessageV2StoredProcedure")(c("LSFactory")(a),{threadKey:l});return d("WAResultOrError").makeResult({isDM:k.ephemeralDurationInSec!=null||k.ephemeralExpirationTs!=null,result:"handled"})});return k.apply(this,arguments)}g["default"]=a}),98);
__d("instamadilloUpdateThreadSnippet",["fbt","FBLogger","I64","LSFactory","LSUpdateThreadSnippetFromLastMessageV2StoredProcedure","MAWAuthor","MAWCurrentUser","ReQL","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){"use strict";var i;function a(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){b=d("MAWAuthor").getAuthorUserJid(b.author);if(b==null)return c("FBLogger")("igd_web_on_msgr").warn("Skip instamadilloBumpThread: a message cannot exist without an author");b=(i||(i=d("I64"))).of_string(d("WAJids").userIdFromJid(b));e=e.threadKey;var f=(yield a.threads.get(e));b=i.equal(b,i.of_string(d("MAWCurrentUser").getID()));var g=(yield d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.reactions.index("fk_messages"),["timestampMs","reaction"]).getKeyRange(e))),j=f==null?void 0:f.lastActivityTimestampMs,k=g==null?void 0:g.timestampMs;g=g==null?void 0:g.reaction;if(!b&&k!=null&&j!=null&&(i||(i=d("I64"))).ge(k,j)){b=g==="\u2764"?h._("__JHASH__OReA5_HIL7u__JHASH__"):h._("__JHASH__DNdID1Qj-5R__JHASH__",[h._param("emoji reaction",g)]);if(f!=null){k=babelHelpers["extends"]({},f,{snippet:b.toString()});yield a.threads.put(k)}}else yield c("LSUpdateThreadSnippetFromLastMessageV2StoredProcedure")(c("LSFactory")(a),{threadKey:e})});return j.apply(this,arguments)}g["default"]=a}),226);
__d("handleInstamadilloSupplementMessageReactionContent",["FBLogger","I64","LSAuthorityLevel","MAWAuthor","WAJids","WAResultOrError","asyncToGeneratorRuntime","instamadilloBumpThread","instamadilloUpdateThreadSnippet"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,d,e){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){var i=d("MAWAuthor").getAuthorUserJid(b.author);if(i==null){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloSupplementMessageReactionContent: authorJid should not be null or undefined");return d("WAResultOrError").makeResult({reason:"missing_author",result:"skip"})}i=(h||(h=d("I64"))).of_string(d("WAJids").userIdFromJid(i));var j=f.emoji;f=f.reactionStatus;if(j==null||f==null){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloSupplementMessageReactionContent: reaction must have a associated emoji and status type");return d("WAResultOrError").makeResult({reason:"missing_required_arg",result:"skip"})}var k=g.messageId,l=g.threadKey,m=(yield a.reactions.get(l,k,i));if(f==="deleted"&&(m==null||m.reaction!==j))return d("WAResultOrError").makeResult({reason:"missing_required_arg",result:"skip"});if(m!=null&&(h||(h=d("I64"))).lt(e,m==null?void 0:m.timestampMs))return d("WAResultOrError").makeResult({reason:"reaction_already_exists",result:"skip"});if(f==="deleted")yield a.reactions["delete"](l,k,i);else{m=(h||(h=d("I64"))).of_int32(c("LSAuthorityLevel").AUTHORITATIVE);f={actorId:i,authorityLevel:m,messageId:k,reaction:j,threadKey:l,timestampMs:e,transportKey:"Instamadillo"};yield a.reactions.put(f);yield c("instamadilloUpdateThreadSnippet")(a,b,g);yield c("instamadilloBumpThread")(a,b,e)}return d("WAResultOrError").makeResult({isDM:g.ephemeralDurationInSec!=null||g.ephemeralExpirationTs!=null,result:"handled"})});return i.apply(this,arguments)}g["default"]=a}),98);
__d("handleInstamadilloSupplementMessagePayload",["FBLogger","I64","InstamadilloMessageIdUtils","WAJids","WAResultOrError","asyncToGeneratorRuntime","handleInstamadilloSupplementMessageEditTextContent","handleInstamadilloSupplementMessageReactionContent"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,d){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=f.content;if(g==null){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloSupplementMessagePayload: Missing content in supplement message payload");return d("WAResultOrError").makeResult({reason:"missing_required_arg",result:"skip"})}f=f.targetMessageOtid;if(f==null){c("FBLogger")("igd_web_on_msgr").warn("Skip handleInstamadilloSupplementMessagePayload: Missing message otid reference in supplement message payload");return d("WAResultOrError").makeResult({reason:"missing_required_arg",result:"skip"})}var i=d("WAJids").threadIdForChatJid(b.chat);i=(h||(h=d("I64"))).of_string(i);i=d("InstamadilloMessageIdUtils").toInstamadilloMessageId(i,f);f=(yield a.messages.index("messageId").get(i));if(f==null){c("FBLogger")("igd_web_on_msgr").info("handleInstamadilloSupplementMessagePayload: tried to receive reaction to a message that does not exist locally");return d("WAResultOrError").makeResult({result:"pending",targetMessageId:i,type:"supplement"})}if(g.editText!=null)return c("handleInstamadilloSupplementMessageEditTextContent")(a,b,e,g.editText,f);else if(g.reaction!=null)return c("handleInstamadilloSupplementMessageReactionContent")(a,b,e,g.reaction,f);return d("WAResultOrError").makeResult({result:"pending",targetMessageId:i,type:"supplement"})});return i.apply(this,arguments)}g["default"]=a}),98);
__d("handleInstamadilloTransportPayload",["FBLogger","I64","IGDDisappearingMsgCleaner","IGDEphemeralConstants","IGDMessageAuxiliaryInfo","InstamadilloMessageIdUtils","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","handleInstamadilloAddMessagePayload","handleInstamadilloDeleteMessagePayload","handleInstamadilloSupplementMessagePayload"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,d,e){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){c=(yield j(a,b,c,e));if(c.success){b=d("InstamadilloMessageIdUtils").getInstamadilloMessageIdFromProtocolMsgId(b);yield d("IGDMessageAuxiliaryInfo").upsertIGMessageAuxiliaryInfoTxn(a,{"final":!0,messageId:b,openEb:Boolean(e.openEb),origin:f})}return c});return i.apply(this,arguments)}function j(a,b,c,d){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){try{if(f.add!=null){var g=(yield c("handleInstamadilloAddMessagePayload")(a,b,e,f.add)),i=d("WATimeUtils").castMilliSecondsToUnixTime((h||(h=d("I64"))).to_float(e));d("IGDDisappearingMsgCleaner").addNewDisappearingTimestamp(d("WATimeUtils").futureUnixTime(d("IGDEphemeralConstants").ephemeralReportingWindowInSeconds,i));if(g.success===!0&&g.value.result==="handled"){return babelHelpers["extends"]({},g,{value:babelHelpers["extends"]({},g.value,{isDM:(f==null?void 0:(i=f.add)==null?void 0:(i=i.metadata)==null?void 0:(i=i.ephemeralityParams)==null?void 0:i.ephemeralDurationSec)!=null})})}return g}else if(f["delete"]!=null)return yield c("handleInstamadilloDeleteMessagePayload")(a,b,f["delete"]);else if(f.supplement!=null)return yield c("handleInstamadilloSupplementMessagePayload")(a,b,e,f.supplement);else return d("WAResultOrError").makeResult({result:"pending",type:"unknown"})}catch(a){c("FBLogger")("igd_web_on_msgr").catching(a).mustfix("Unable to handle instamadillo transport payload");return d("WAResultOrError").makeError("handler_fatal")}});return k.apply(this,arguments)}g["default"]=a}),98);
__d("handleInstamadilloTransportPayloadForStanza",["MAWTimeUtils","WATimeUtils","handleInstamadilloTransportPayload"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){b=b.message.decrypted;var f=b.id;b=b.ts;b=d("MAWTimeUtils").millisTimeToTimestamp(d("WATimeUtils").castUnixTimeToMillisTime(b));return c("handleInstamadilloTransportPayload")(a,f,b,e,"WA")}g["default"]=a}),98);
__d("IGDCOPMessageHandler",["FBLogger","IGDCOPTransportResultFollowups","InstamadilloMessageIdUtils","InstamadilloStanzaDecoder","MAWEBSwitch","MAWIsQuotaExceededError","MAWProtocolQueueUtils","MAWReStoreDb","MAWSharedCOPLogger","MAWSharedCOPLoop","MWPPendingMessageStanzaQueue","Promise","WAProtocolQueue","WAResultOrError","addReceivedMessagesToEbUploadQueue","asyncToGeneratorRuntime","handleInstamadilloTransportPayloadForStanza","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["message consumer: ",""]);i=function(){return a};return a}var j=c("requireDeferred")("ArmadilloReceiveWriteDbFailureFalcoEvent").__setRef("IGDCOPMessageHandler"),k=c("requireDeferred")("ArmadilloReceiveWriteDbSuccessFalcoEvent").__setRef("IGDCOPMessageHandler");function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b.success===!1||b.value.result!=="pending")return b;try{yield d("MWPPendingMessageStanzaQueue").persist(a,b.value.type,b.value.targetMessageId);return b}catch(a){c("FBLogger")("igd_web_on_msgr").catching(a).mustfix("maybePersistStanzaToPendingMessageQueue: Failed to persist stanza to pending queue");return d("WAResultOrError").makeError("failure_to_persist_pending_queue")}});return m.apply(this,arguments)}function n(a,b,d){var e;a.success===!0&&((e=a.value)==null?void 0:e.result)!=="skip"&&((e=a.value)==null?void 0:e.isDM)!==!0&&(c("addReceivedMessagesToEbUploadQueue")(b,d),c("promiseDone")(k.load(),function(a){return a.log(function(){return{encrypted_backup_enable:c("MAWEBSwitch").isEnabled(),message_id:b.message.decrypted.id.externalId}})}));a.success===!1&&c("promiseDone")(j.load(),function(a){return a.log(function(){var a;return{encrypted_backup_enable:c("MAWEBSwitch").isEnabled(),message_id:b==null?void 0:(a=b.message)==null?void 0:(a=a.decrypted)==null?void 0:(a=a.id)==null?void 0:a.externalId}})})}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=(yield d("InstamadilloStanzaDecoder").decodeStanza(b));if(e==null)return l(b,d("WAResultOrError").makeResult({result:"pending",type:"unknown"}));var f=e.stanza;e=e.transportPayload;a=(yield c("handleInstamadilloTransportPayloadForStanza")(a,f,e));n(a,f,e);return l(b,a)});return p.apply(this,arguments)}function q(a,b){if(b.success===!0){var c;if(((c=b.value)==null?void 0:c.result)==="skip"){a.receiveFlow.endSuccess({string:{skip_reason:(c=(c=b.value)==null?void 0:c.reason)!=null?c:""}})}else a.receiveFlow.endSuccess()}else a.receiveFlow.endFail(b.error)}function r(a,e){return(h||(h=b("Promise"))).all(e.map(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=b.pendingMessageStanzaQueueId;b.pendingMessageStanzaQueueType;b.targetMessageId;b=babelHelpers.objectWithoutPropertiesLoose(b,["pendingMessageStanzaQueueId","pendingMessageStanzaQueueType","targetMessageId"]);var f=d("MAWProtocolQueueUtils").addMetricToMessage({stanza:b});try{yield d("MWPPendingMessageStanzaQueue").ack([e]);e=(yield o(a,b));q(f,e);return e}catch(a){f.receiveFlow.endFail("failure_to_ack_pending_stanza");c("FBLogger")("igd_web_on_msgr").catching(a).mustfix("maybePersistStanzaToPendingMessageQueue: Failed to ack pending stanza, abort handling pending stanza");return d("WAResultOrError").makeError("failure_to_ack_pending_stanza")}});return function(a){return e.apply(this,arguments)}}()))}function s(a){var b=[];for(a of a)if(a.success===!0){var c;if(a.value.result==="handled"&&((c=a.value.followUpParams)==null?void 0:c.decodedMediaEntry)!=null&&((c=a.value.followUpParams)==null?void 0:c.protocolMsgId)!=null){c=a.value.followUpParams;var d=c.decodedMediaEntry;c=c.protocolMsgId;b.push({decodedMediaEntry:d,protocolMsgId:c})}}return b}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.map(function(a){return d("MAWProtocolQueueUtils").addMetricToMessage({stanza:babelHelpers["extends"]({},a)})});a=(yield d("MAWReStoreDb").getDB());return a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield (h||(h=b("Promise"))).all(c.map(function(b){return o(a,b.stanza)})));c.forEach(function(a,b){q(a,e[b])});var f=c.map(function(a){return a.stanza.stanzaQueueId}).filter(function(a,b){return e[b].success===!0}),g=new Set(c.map(function(a){return d("InstamadilloMessageIdUtils").getInstamadilloMessageIdFromStanza(a.stanza)})),i=(yield d("MWPPendingMessageStanzaQueue").read()).filter(function(a){return a.targetMessageId!=null&&g.has(a.targetMessageId)});i=(yield r(a,i));i=[].concat(s(e),s(i));return{followUpParams:{mediaEntriesToDownload:i},toAck:f}});return function(b){return a.apply(this,arguments)}}(),"readwrite")});return u.apply(this,arguments)}function a(a,b){return v(a,b)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(i(),a);return[]})}function v(a,b){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a.length===0)return[];var e=(yield t(a.map(d("WAProtocolQueue").mapProcolQueueMessageV2toV1)));c("promiseDone")(b.awaitUserFacing(d("MAWSharedCOPLoop").makeCopGUID("IGDCOPMediaEntryDownloadFollowUp"),function(){return d("IGDCOPTransportResultFollowups").maybeFollowupMediaTransportResult(e.followUpParams.mediaEntriesToDownload)},d("MAWSharedCOPLoop").COPBehaviour.NON_BLOCKING));return e.toAck});return w.apply(this,arguments)}g.handlePendingMessageStanzas=r;g.getMediaEntriesToDownload=s;g.handleIncomingDecodedInstamadilloStanzas=t;g.copIncomingMsgsHandler=a}),98);
__d("MWPPendingMessageStanzaQueueInit",["IGDCOPMessageHandler","MAWReStoreDb","MWPPendingMessageStanzaQueue","WALogger","WAPersistedQueue","WAPersistedQueueApi","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Pending Message Stanza Queue is already initialized"]);h=function(){return a};return a}function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("MWPPendingMessageStanzaQueue").read()),b=(yield d("MAWReStoreDb").getDB());c("promiseDone")(b.runInTransaction(function(b){return d("IGDCOPMessageHandler").handlePendingMessageStanzas(b,a)},"readwrite"))});return i.apply(this,arguments)}var j=null;function e(){return j==null?k():j}function k(){j!=null&&d("WALogger").ERROR(h());var a=d("WAPersistedQueue").initPersistedQueue("pendingMessageStanzaQueue",d("WAPersistedQueueApi").dexieApiForPersistedQueue(),{cacheSize:null,maxDelay:5e3});j=a;return a}g.processFutureproofPendingMessageStanzas=a;g.igdPendingMessageStanzaQueue=e;g.initPendingMessageStanzaQueue=k}),98);
__d("MWPPendingMessageStanzaQueue",["MWPPendingMessageStanzaQueueInit"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){var e=d("MWPPendingMessageStanzaQueueInit").igdPendingMessageStanzaQueue();return e.addAndCommit([babelHelpers["extends"]({},a,{pendingMessageStanzaQueueType:b,targetMessageId:c})])}function b(a){var b=d("MWPPendingMessageStanzaQueueInit").igdPendingMessageStanzaQueue();return b.ack(a)}function c(a){var b=d("MWPPendingMessageStanzaQueueInit").igdPendingMessageStanzaQueue();return b["delete"](a)}function e(){var a=d("MWPPendingMessageStanzaQueueInit").igdPendingMessageStanzaQueue();return a.read()}g.persist=a;g.ack=b;g.deleteQueueIDs=c;g.read=e}),98);
__d("IGDCOPReceiptsHandler",["IGDAWProtocolQueueReceipt","MAWIsQuotaExceededError","MAWSharedCOPLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing receipts batch, see transactor error reports."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["receipt consumer: ",""]);i=function(){return a};return a}function a(a){return j(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(i(),a);return[]})}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];var b=(yield d("IGDAWProtocolQueueReceipt").handleIncomingReceiptStanza(a));b.toAck.length!==a.length&&c("MAWSharedCOPLogger").WARN(h());return b.toAck});return k.apply(this,arguments)}g["default"]=a}),98);
__d("IGDGetMediaKnownEntriesApi",["I64","MAWDbMsg","MAWJids","MAWMediaUtils","MAWReStoreDb","Promise","WAJids","WALogger","WAMsgMap","WAStanzaUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["No existing media entry found for hashedPlaintextHash ",". Returning new MsgMap."]);j=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=(yield d("MAWReStoreDb").getDB()),e=d("MAWMediaUtils").genHMACPlaintextHash(a);a=(yield c.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=(yield a.e2ee_media.index("hashedPlaintextHash").get(e));if(c==null){d("WALogger").ERROR(j(),e);return new(d("WAMsgMap").MsgMap)()}var f=Array.from(c.mediaEntries.keys());f=(yield (i||(i=b("Promise"))).all(f.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=(yield a.messages.index("messageId").get(b));return b});return function(a){return c.apply(this,arguments)}}())));f=f.reduce(function(a,b){if(b!=null){var e=c.mediaEntries.get(d("MAWDbMsg").instamadilloMsgIdToMsgId(b.messageId)),f=d("WAJids").validateUserJid(d("WAJids").toMsgrUserJid((h||(h=d("I64"))).to_string(b.threadKey))),g=d("WAStanzaUtils").toStanzaId(b.offlineThreadingId);if(e&&!b.isAdminMessage&&f!=null){b={author:d("MAWJids").toUserJid((h||(h=d("I64"))).to_string(b.senderId)),chat:f,externalId:g};a.set(b,e)}}return a},new(d("WAMsgMap").MsgMap)());return f});return function(b){return a.apply(this,arguments)}}(),"readonly"));return a});return function(b){return a.apply(this,arguments)}}();g.getMediaKnownEntries=a}),98);
__d("IGDProtocolQueueProcess",["IGDCOPInstructionsHandler","IGDCOPMessageHandler","IGDCOPReceiptsHandler","MAWCOPNotificationsHandler","MAWCOPRetryHandler","MAWSharedCOP","MAWSharedCOPHandler","MAWSharedCOPLogger","MAWSplitProtocolEntityByType","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["New COP handler for "," msgs, "," appdatas, "," notifications, "," receipts, "," retries, "," instructions"]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){a=c("MAWSplitProtocolEntityByType")(a);c("MAWSharedCOPLogger").LOG(i(),a.messages.length,a.appdatas.length,a.notifications.length,a.receipts.length,a.retries.length,a.instructions.length);e.startPoint(d("MAWSharedCOPHandler").ConsumerProcessingStages.PERSIST);e.startPoint(d("MAWSharedCOPHandler").ConsumerProcessingStages.PERSIST);var f=d("MAWSharedCOP").getCOP();f=(yield (h||(h=b("Promise"))).all([d("IGDCOPMessageHandler").copIncomingMsgsHandler(a.messages,f.queue),c("IGDCOPInstructionsHandler")(a.instructions),c("IGDCOPReceiptsHandler")(a.receipts),c("MAWCOPNotificationsHandler")(a.notifications,f.queue),c("MAWCOPRetryHandler")(a.retries)])).flat();e.endPoint(d("MAWSharedCOPHandler").ConsumerProcessingStages.PERSIST);e.endSuccess();return f});return j.apply(this,arguments)}g.processProtocolQueueEntries=a}),98);
__d("InstamadilloMediaUpload",["FBLogger","IGDGetMediaKnownEntriesApi","IGDGetMediaPlaintextApi","IGDUpdateMediaEntryForMsgApi","LSIntEnum","MAWFetchXMABlob","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWMediaUtils","MAWOptimisticUploadMedia","MAWStartMediaUploaQplFlow","MAWUpdateMediaEntryForOptimisticUploadApi","MessagingAttachmentType","WAAPI","WAHashUtils","WAMediaCrypto","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=(yield d("MAWMediaUtils").hashBlob(b));f=d("WAHashUtils").toPlaintextHash(f);var g=e.type==="regular"?e.mediaType:"preview",h=(yield d("MAWStartMediaUploaQplFlow").startMediaUploaQplFlow({chatJid:a.chat,fileSize:b.size,serverMediaType:g,uploadEntry:"InstamadilloMediaUpload"}));return c("WAAPI").uploadMedia({chatJid:a.chat,filename:g==="document"?b.name:void 0,getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("IGDGetMediaKnownEntriesApi").getMediaKnownEntries,getMediaPlaintext:d("IGDGetMediaPlaintextApi").getMediaPlaintext,hash:f,mediaTypeDetails:e,protocolMsgId:a,size:b.size,updateMediaEntryForMsg:d("IGDUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload,uploadMediaMetric:h})});return j.apply(this,arguments)}function a(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(e.playableUrlMimeType==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("instamadilloUpload: mimeType is null");var f=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(e.playableUrlMimeType);f=f.serverMediaType;var g=(yield i(a,b,{mediaType:f,type:"regular"}));if(g.success!==!0)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("instamadilloUpload: Failed to upload media");var j=null,k=(h||(h=d("LSIntEnum"))).unwrapIntEnum(e.attachmentType);e=(yield d("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"InstamadilloMediaUpload",url:e.previewUrl}));if(e!=null){e=(yield e.arrayBuffer());k=k===c("MessagingAttachmentType").IMAGE||k===c("MessagingAttachmentType").VIDEO?d("MAWMediaUtils").convertJpegThumbnailArrayBufferToFile(e):null;if(k&&d("MAWOptimisticUploadMedia").shouldUploadPreview(f,b.size)){e=d("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(f);b=(yield i(a,k,{messageType:e,type:"preview"}));if(b.success!==!0)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("instamadilloUpload: Failed to upload preview media");j=b.value}}return{mediaEntry:g.value,thumbnailMediaEntry:j}});return k.apply(this,arguments)}g.instamadilloUpload=a}),98);
__d("createInstamadilloMediaPayload",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.directPath,d=a.duration,e=a.fileEncSha256,f=a.fileLength,g=a.fileSha256,m=a.height,n=a.isAnimated,o=a.isSticker,p=a.mediaId,q=a.mediaKey,r=a.mediaKeyTimestamp,s=a.mediaType,t=a.mimetype,u=a.objectId,v=a.sidecar,w=a.thumbnail,x=a.waveforms,y=a.waveformSamplingFrequencyHz;a=a.width;b={directPath:b,fileEncSha256:e,fileLength:f,fileSha256:g,mediaId:p,mediaKey:q,mediaKeyTimestamp:r,mimetype:t,objectId:u,sidecar:v};switch(s){case"Image":return h(m,a,b,w);case"Video":return i(m,a,b,w);case"Ptt":if(x==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("createInstamadilloMedia: waveforms is null");return j(d,b,x,y);case"Gif":return k(m,a,b,o);case"Sticker":return l(b,n);default:throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("createInstamadilloMedia: mediaType is unsupported")}}function h(a,b,c,d){return{staticPhoto:{height:a,mediaTransport:c,thumbnail:d,width:b}}}function i(a,b,c,d){return{video:{height:a,mediaTransport:c,thumbnail:d,width:b}}}function j(a,b,c,d){return{voice:{duration:a,mediaTransport:b,waveforms:c,waveformSamplingFrequencyHz:d}}}function k(a,b,c,d){return{gif:{height:a,isSticker:d,mediaTransport:c,width:b}}}function l(a,b){return{avatarSticker:{isAnimated:b,mediaTransport:a}}}g.createInstamadilloMediaEncode=a}),98);
__d("InstamadilloSendMediaMessageUtils",["FBLogger","I64","InstamadilloMediaUpload","LSIntEnum","MAWDbMsg","MAWFetchXMABlob","MAWFrontendMediaUtils","MAWMediaUtils","MAWReStoreDb","MessagingAttachmentType","ReQL","WABase64","WAMediaUtils","WASortedLists","WATimeUtils","asyncToGeneratorRuntime","createInstamadilloMediaPayload"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachments).getKeyRange(b,c)));return a});return j.apply(this,arguments)}function k(a){return{validatedAudioInfo:l(a),validatedDocumentFileInfo:null,validatedImageInfo:m(a),validatedVideoInfo:n(a)}}function l(a){return(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO))?{duration:a.playableDurationMs?(h||(h=d("I64"))).to_float(a.playableDurationMs):0,mimetype:a.playableUrlMimeType}:null}function m(a){return(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE))?{height:a.previewHeight?(h||(h=d("I64"))).to_float(a.previewHeight):0,width:a.previewWidth?(h||(h=d("I64"))).to_float(a.previewWidth):0}:null}function n(a){return(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO))?{duration:a.playableDurationMs?(h||(h=d("I64"))).to_float(a.playableDurationMs):0,height:a.previewHeight?(h||(h=d("I64"))).to_float(a.previewHeight):0,mimetype:a.playableUrlMimeType,width:a.previewWidth?(h||(h=d("I64"))).to_float(a.previewWidth):0}:null}function o(a){var b=a.directPath,c=a.fbid,e=a.fileEncSha256,f=a.fileSha256,g=a.mediaKey,h=a.mediaKeyTimestamp;a=a.objectId;return{directPath:b,fileEncSha256:d("WABase64").encodeB64(e),fileSha256:d("WABase64").encodeB64(f),mediaId:(b=c)!=null?b:void 0,mediaKey:d("WABase64").encodeB64(g),mediaKeyTimestamp:String(h),objectId:(e=a)!=null?e:void 0}}function e(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f,g=(yield d("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"InstamadilloSendMediaMessageUtils",url:e.playableUrl}));if(g==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("Blob is null");var i=e.playableUrlMimeType;if(i==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("IGDSendMessageTaskHandler: mimeType is null");var j=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(i),l=j.mediaType;j=j.serverMediaType;if(l==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("handleInstamadilloMediaSends: mediaType is null");var m=(yield d("MAWMediaUtils").genBlobHashes(g)),n=m[0],p=m[1];m=(yield d("MAWReStoreDb").getDB());var q=(yield m.runInTransaction(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=(yield b.e2ee_media.index("hashedPlaintextHash").get(p)),f=new Map(c==null?void 0:c.mediaEntries),h=k(e),j=d("MAWDbMsg").stanzaIdToMsgId(a.externalId);if(c!=null){var m=d("WASortedLists").addToSet(c.msgIds,j);c=babelHelpers["extends"]({},c,h,{mediaEntries:f,msgIds:m})}else c=babelHelpers["extends"]({hashedPlaintextHash:p,mediaEntries:f,mediaType:l,msgIds:d("WASortedLists").singleElement(j),plaintextHash:n,size:g.size,ts:d("WATimeUtils").unixTime()},h);yield b.e2ee_media.put(c);m=(yield d("WAMediaUtils").blobToArrayBuffer(g));f=(yield b.e2ee_chunk.index("hashedPlaintextHash").get(p));f==null&&(yield b.e2ee_chunk.put({blobData:m,hashedPlaintextHash:p,mimetype:i,plaintextHash:n}));return c});return function(a){return c.apply(this,arguments)}}(),"readwrite"));f=new File([g],(f=e.filename)!=null?f:"",{type:i});var r=(yield d("InstamadilloMediaUpload").instamadilloUpload(a,f,e)),s=r.mediaEntry;r=r.thumbnailMediaEntry;var t=babelHelpers["extends"]({},q,{objectId:s.objectId!=null?d("WAMediaUtils").stringToDeliveryObjectId(s.objectId):void 0});yield m.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield a.e2ee_media.put(t)});return function(b){return a.apply(this,arguments)}}(),"readwrite");q=o(s);q.$$unknownFieldCount;m=babelHelpers.objectWithoutPropertiesLoose(q,["$$unknownFieldCount"]);s=babelHelpers["extends"]({},m,{duration:e.playableDurationMs!=null?(h||(h=d("I64"))).to_int32(e.playableDurationMs):void 0,fileLength:f.size,height:e.previewHeight!=null?(h||(h=d("I64"))).to_int32(e.previewHeight):void 0,isAnimated:!1,isSticker:!1,mediaType:l,mimetype:i,sidecar:void 0,waveforms:e.waveformData!=null?e.waveformData.split(",").map(Number):void 0,waveformSamplingFrequencyHz:e.samplingFrequencyHz!=null?(h||(h=d("I64"))).to_int32(e.samplingFrequencyHz):void 0,width:e.previewWidth!=null?(h||(h=d("I64"))).to_int32(e.previewWidth):void 0});if(r!=null){q=o(r);q.$$unknownFieldCount;m=babelHelpers.objectWithoutPropertiesLoose(q,["$$unknownFieldCount"]);f={mediaTransport:m};s=babelHelpers["extends"]({},s,{thumbnail:f})}r=d("createInstamadilloMediaPayload").createInstamadilloMediaEncode(s);return{media:t,mediaEncode:r,serverMediaType:j}});return p.apply(this,arguments)}g.getMediaAttachment=a;g.generateValidatedMediaInfoFromAttachment=k;g.prepareMediaProtobuf=e}),98);
__d("MAWDbGetDeviceChangeAlertsTxn",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.deviceChangeAlerts.get(b)}f.getDeviceChangeAlertsTxn=a}),66);
__d("WADevToolsDebugFns",["WADevToolsBridge"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b={};for(var c in a){var e=a[c];b[c]={id:c,args:e.serializedArgs,desc:e.desc,title:e.name}}d("WADevToolsBridge").getDevToolBridge().setHandlers("backend",{getDebugFns:function(){return b},callDebugFn:function(b){var c=b.id;b=b.args;(c=a[c]).execute.apply(c,b)}})}function b(a,b){return babelHelpers["extends"]({name:a},b)}g.registerDebugFnsToDevTool=a;g.defineDebugFunction=b}),98);
__d("MAWDebugHydrateOfflineQueue",["MAWExternalId","MAWIndexedDb","MAWJobDefinitions","MAWJobManager","MAWTransactionMode","WADbTransactor","WADevToolsDebugFns","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,c){var e=c.maxMessages,f=c.minMessages;return d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"debug",function(c){return function(){return c.participants.toArray().then(function(b){return b.filter(function(b){return b.userJid===a.contactJid})}).then(function(a){a=a.map(function(a){return a.threadJid});return c.threads.where("jid").anyOf(a).toArray().then(function(a){return Array.from(new Set(a.filter(function(a){return(a==null?void 0:a.archived)!==!0}).map(function(a){return a==null?void 0:a.jid}).filter(Boolean)))})}).then(function(a){setTimeout(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){for(var b of a){var c=Math.floor(Math.random()*e)+f;for(var g=0;g<c;g++)yield d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendMsg(b,{content:"Message "+g},d("MAWExternalId").generateExternalId()))}}),0)})}})()},i=function(a){return d("WADbTransactor").makeSignalTransactor({contacts:d("MAWTransactionMode").READONLY},"debug",function(b){return function(){var d=b.contacts.filter(function(b){return b.contactJid===a}).toArray();return d.then(function(a){if(a.length===0)throw c("err")("No participant found");a=a[0];return a})}})()};a=d("WADevToolsDebugFns").defineDebugFunction("hydrateOfflineQueue",{desc:"Hydrate the offline queue for a target user",execute:function(a,b,c){return i(a).then(function(a){return h(a,{maxMessages:b,minMessages:c})})},serializedArgs:[{desc:"Name or Jid of the target user",name:"targetUserNameOrJid",placeholder:"Target user name or Jid",type:"string"},{desc:"Max number of messages per thread to send",name:"maxMessages",placeholder:"30",type:"number"},{desc:"Min number of messages per thread to send",name:"minMessages",placeholder:"1",type:"number"}]});g.hydrateOfflineQueue=a}),98);
__d("MAWDebugSendMultipleMsgs",["MAWJobDefinitions","MAWJobManager","Promise","WADevToolsDebugFns"],(function(a,b,c,d,e,f,g){"use strict";var h;a=d("WADevToolsDebugFns").defineDebugFunction("sendMultipleMsgs",{desc:"Sends multiple messages to a thread",execute:function(a,c){return(h||(h=b("Promise"))).all(Array.from(Array(c).keys()).map(function(b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendMsg(a,{content:b+" message"}))}))},serializedArgs:[{desc:"ChatJid of the thread to send messages to",name:"chatJid",placeholder:"1234@msgr",type:"string"},{desc:"Number of messages to send",name:"numberOfMsgs",placeholder:"100",type:"number"}]});g.sendMultipleMsgs=a}),98);
__d("WADbContactsTxns",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.contacts.where("contactJid").anyOf(b).toArray()}function b(a,b){return a.contacts.get({contactJid:b})}f.getContacts=a;f.getContact=b}),66);
__d("WAGetContactAndIdentitiesApi",["MAWDexieTable","MAWTransactionMode","WADbContactsTxns","WADbIdentityTxns","WADbTransactor","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({contacts:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READONLY},"getContactAndIdentitiesForUser",function(a){return function(b){return d("MAWDexieTable").dexieAll([d("WADbContactsTxns").getContact(a,b),d("WADbIdentityTxns").getIdentitiesForUser(a,b)]).then(function(a){var b=a[0];a=a[1];if(b==null)return d("WAResultOrError").makeError("missing_contact");else{b={contact:{dhash:b.dhash,icdcInfo:b.icdcInfo},identities:a.map(function(a){return{deviceJid:a.deviceJid,identity:a.identity}})};return d("WAResultOrError").makeResult(b)}})}});g.getContactAndIdentitiesForUser=a}),98);
__d("MAWDebug",["MAWBridge","MAWBulkHandleIncomingMsgApi","MAWConfig","MAWCreateThreadThroughMI","MAWDbAddDeviceChangeAlertsTxn","MAWDbAppDataTxns","MAWDbChunkTxns","MAWDbEditMsgHistoryTxns","MAWDbGetDeviceChangeAlertsByOptionsTxn","MAWDbGetDeviceChangeAlertsTxn","MAWDbGetUnArchivedDeviceChangeAlertsCountTxn","MAWDbGroupInfoTxns","MAWDbGroupInviteTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDbMsgTypeVersionTxns","MAWDbObjDecode","MAWDbObjEncode","MAWDbParticipantTxns","MAWDbPendingReceiptTxns","MAWDbReactionsTxns","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWDbUpdateDeviceChangeAlertsTxn","MAWDbVersion","MAWDbXMATxns","MAWDebugHydrateOfflineQueue","MAWDebugSendMultipleMsgs","MAWEncryptedBackupCacheManager","MAWEphemeralCleaner","MAWEphemeralSettingsTxns","MAWExternalId","MAWHandleEchoMsgsRestoreApiV2","MAWJobDefinitions","MAWJobManager","MAWKeychainCrypto","MAWKeychainNaClCrypto","MAWLoadMsgsApi","MAWMediaUtils","MAWSendSenderKeyDistributionMsg","MAWTransactionMode","MAWTransactor","MAWVault","MWEARKeychainV3","OfflineThreadingId","Promise","WAAPI","WAAbPropsInit","WAArmadilloXMA.pb","WACompareIdentity","WADbContactsTxns","WADbIdentityTxns","WADbMetaTxns","WADbPersonalSenderKeyStatusTxns","WADbPrekeyTxns","WADbSenderKeySessionTxns","WADbSessionTxns","WADbSignal","WADbSignedPrekeyTxns","WADbTransactor","WADevicesState","WAExceededStorageQuota","WAGatherMediaInfo","WAGetContactAndIdentitiesApi","WAGlobals","WAGzip","WAHandleFailureUtils","WAJids","WAJobOrchestratorTypes","WALogger","WAMediaUtils","WAPREList","WAPREMetrics","WAProtocolQueue","WARotateSignedPreKey","WASignalKeys","WASignalOther","WATimeUtils","WebStorageEstimator","asyncToGeneratorRuntime","err","gkx","promiseDone","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}var j={UNSAFE_changeMyIdentity:function(){void m({meta:d("MAWTransactionMode").READWRITE})(function(a){return a.meta.put({key:d("WADbSignal").MetaKeysEnum.identityKeyPair,value:{identityKeyPair:d("WASignalKeys").makeKeyPair()}}).then(function(){})})()},addBadProtocolQueueInstruction:function(){var a={instruction:"bad",type:"instruction"};return d("WAProtocolQueue").protocolQueue().addAndCommit([a])},addDeviceChangeAlerts:function(a){return k(l({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn)(a))},addGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.addGroupParticipants(a,b))},checkStorageQuota:function(){return d("WAExceededStorageQuota").checkStorageQuota()},clearICDCInfo:function(a){return k(m({contacts:d("MAWTransactionMode").READWRITE})(function(b){return b.contacts.get(a).then(function(a){if(a!=null){a.icdcInfo=void 0;a.icdcFails=void 0;a.lastSyncTs=d("WATimeUtils").unixTime();return b.contacts.put(a).then(function(){return"contact-updated"})}return"contact-missing"})})())},compareIdentity:function(){return k(m({identity:d("MAWTransactionMode").READONLY,meta:d("MAWTransactionMode").READONLY})(d("WACompareIdentity").compareIdentityDexie)())},createGroup:function(a,b,c){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").createStartJobInfo("createGroup",{extras:{clientThreadKey:c,platform:"msgr"},key:c,subject:a,users:b}))},createThread:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","createThread",{contactFbid:a,threadKey:d("OfflineThreadingId").createOfflineThreadingID()})},createThreadThroughMI:function(a,b,c,e){return d("MAWCreateThreadThroughMI").createThreadThroughMI({authoritativeThreadKey:a,chatJid:b,lastActivityTimestampMs:c,lastReadWatermarkTimestampMs:e,numOfMsgsToLoad:1}).then(function(){})},decodeEAR:function(a,b){return d("MAWDbObjDecode").decodeDbObj(a,b)},decryptEARTweetNaCl:function(a,b){return d("MAWKeychainNaClCrypto").decryptTweetNaCl(a,b)},decryptWithKeyVersion:function(a,b){var c=d("MWEARKeychainV3").getDbEncryptionKey(a);c=c.key;return d("MAWKeychainNaClCrypto").decrypt(c,b,a)},deflate:function(a){var b=d("WAGzip").createDeflate();b.push(a,!0);return b.result()},deleteGroupInvitesByThreadAndInvitedParticipant:function(a,b){return k(l({groupInvites:d("MAWTransactionMode").READWRITE})(d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant)(a,b))},demoteGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.demoteGroupParticipants(a,b))},deregisterPhone:function(){c("promiseDone")(d("WAHandleFailureUtils").deregisterPhone())},dropExpiredMessagesFromDB:function(){var a=d("MAWEphemeralCleaner").getEphemeralCleaner_FOR_TESTING_ONLY();if(a)a.backend.update(d("WATimeUtils").futureUnixTime(5));else throw c("err")("Cannot delete expired msgs as cleaner is not initialized!")},dropExpiredMessagesFromUI:function(){var a=d("MAWEphemeralCleaner").getEphemeralCleaner_FOR_TESTING_ONLY();if(a)a.ui.update(d("WATimeUtils").futureUnixTime(5));else throw c("err")("Cannot delete expired msgs as cleaner is not initialized!")},encodeEAR:function(a,b){return d("MAWDbObjEncode").encodeDbObj(a,b)},encryptEARTweetNaCl:function(a,b,c){return d("MAWKeychainNaClCrypto").encryptTweetNaCl(a,b,c)},establishOutgoingSession:function(a,b){return c("WAAPI").preEstablishSession({groupJid:a,userJids:b})},estimateStorage:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WebStorageEstimator").estimateStorage());return a});function c(){return a.apply(this,arguments)}return c}(),executeQuery:function(a){var b=Object.keys(d("MAWDbVersion").CURRENT_MAW_STORES).filter(function(a){return d("MAWDbVersion").CURRENT_MAW_STORES[a]!=null}).reduce(function(a,b){return babelHelpers["extends"]({},a,(a={},a[b+""]=d("MAWTransactionMode").READWRITE,a))},{});return l(b)(a)()},forwardMsg:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").createStartJobInfo("forwardMsg",{chatJid:a,externalId:d("MAWExternalId").generateExternalId(),protocolMsgId:b}))},fromUnixTime:function(a){return d("WATimeUtils").toDate(a)},gatherMediaInfo:function(){c("promiseDone")(d("WAGatherMediaInfo").gatherMediaInfo())},generateAndUploadPreKeys:function(){return c("WAAPI").generateAndUploadPreKeys({reason:"test"})},generateAndUploadPreKeysMultipleCalls:function(){return(h||(h=b("Promise"))).all([c("WAAPI").generateAndUploadPreKeys({reason:"test"}),c("WAAPI").generateAndUploadPreKeys({reason:"test"}),c("WAAPI").generateAndUploadPreKeys({reason:"test"})])},generateMessagesForChat:function(a,b){return d("MAWBulkHandleIncomingMsgApi").bulkHandleIncomingMsgs(Array.from({length:b}).map(function(b,c){b=d("WATimeUtils").castMilliSecondsToUnixTime(Date.now());var e=d("MAWExternalId").generateExternalId();c={ack:2,altIndex:void 0,author:"@me",externalId:e,msgContent:{content:"Stub message #"+c},serverTs:b,ts:b,type:"Text"};return{msgData:{device:{id:d("WAJids").extractDeviceId(d("WAGlobals").getMyDeviceJid()),identity:null},folder:null,id:{author:"@me",chat:a,externalId:e},msg:{encoded:new Uint8Array(0),version:"v2"},recipientsCount:null,reportingMeta:null,ts:b,type:"IncomingMsg"},receiveFlow:d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE,{}),unstoredContent:{unstoredDbMedia:null,unstoredDbMsg:c,unstoredDbReaction:null}}})).then(function(){})},getAbProp:function(a){return d("WAAbPropsInit").getAbProp(a)},getAbProps:function(){return d("WAAbPropsInit").getAbProps()},getAllMessageIdsAndRangesForThread:function(a,b){return d("MAWBridge").getBridge().sendAndReceive("backend","getAllMessageIdsAndRangesForThread",{chatJid:a,limit:b})},getAppDatas:function(a){return k(l({appData:d("MAWTransactionMode").READONLY})(d("MAWDbAppDataTxns").bulkGetAppData)(a))},getAppMetaByKey:function(a){return k(l({appMeta:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTypeVersionTxns").getAppMetaValue)(a))},getChunksByChunkId:function(a){return k(l({chunk:d("MAWTransactionMode").READONLY})(d("MAWDbChunkTxns").bulkGetChunks)(a))},getConfig:function(){return Object.fromEntries(Object.entries(d("MAWConfig").getConfig()).map(function(a){var b=a[0];a=a[1];var c;a;try{c=a()}catch(b){c=a}return[b,c]}))},getContacts:function(a){return k(m({contacts:d("MAWTransactionMode").READONLY})(d("WADbContactsTxns").getContacts)(a))},getCurrentUserDeviceList:function(){return c("WAAPI").getCurrentUserDeviceList()},getDeviceChangeAlerts:function(a){return k(l({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetDeviceChangeAlertsTxn").getDeviceChangeAlertsTxn)(a))},getDeviceChangeAlertsByOptions:function(a){return k(l({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetDeviceChangeAlertsByOptionsTxn").getDeviceChangeAlertsByOptionsTxn)(a))},getDeviceChangeAlertsByOptionsLLA:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","getDeviceChangeAlertsByOptions",{options:a})},getDevices:function(a,b){return c("WAAPI").getDevices({ignoreDhash:b,reason:"debug",users:new Set(a)})},getDevicesState:function(){return d("WADevicesState").getDevicesState()},getEAREncryptKeyVersion:function(a){return d("MAWKeychainCrypto").getKeyVersionFromCipherDataString(a)},getEBRestoreCache:function(){return d("MAWEncryptedBackupCacheManager").restoredCache},getEditMsgHistoryByEditMsgHistoryId:function(a){return k(l({editMsgHistory:d("MAWTransactionMode").READONLY})(d("MAWDbEditMsgHistoryTxns").bulkGetEditMsgHistorys)(a))},getEditMsgHistoryByProtocolMsgId:function(a){return k(l({editMsgHistory:d("MAWTransactionMode").READONLY})(d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId)(a))},getGroupInfosByGroupJid:function(a){return k(l({groupInfo:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInfoTxns").getGroupInfos)(a))},getGroupInvite:function(a,b){return k(l({groupInvites:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInviteTxns").maybeGetGroupInvite)(a,b))},getGroupInvitesByThreadAndInvitedParticipant:function(a,b){return k(l({groupInvites:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInviteTxns").getGroupInvitesByThreadAndInvitedParticipant)(a,b))},getHmacKeyFromGlobals:function(){return d("WAGlobals").getHMACKey()},getIdentityByDeviceJid:function(a){return k(m({identity:d("MAWTransactionMode").READONLY})(d("WADbIdentityTxns").bulkGetIdentityRows)(a))},getMediaBackupForObjectId:function(a){return k(l({mediaBackup:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId)(a))},getMediaByIdWithDecodedMediaEntries:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield l({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").bulkGetMedias)(a));a.forEach(function(a){if(!(a==null?void 0:a.mediaEntries))return;a.mediaEntries=new Map(Array.from(a.mediaEntries,function(a){var b=a[0];a=a[1];return[b,d("WAMediaUtils").decodeMediaEntryData(a)]}))});return k((h||(h=b("Promise"))).resolve(a))});function c(b){return a.apply(this,arguments)}return c}(),getMediaByMediaId:function(a){return k(l({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").bulkGetMedias)(a))},getMessagesByMsgIds:function(a){return k(l({messages:d("MAWTransactionMode").READONLY})(function(b){return b.messages.where("msgId").anyOf(a).toArray().then(function(a){return a.filter(Boolean)})})(a))},getMeta:function(){return k(m({meta:d("MAWTransactionMode").READONLY})(d("WADbMetaTxns").getAllMeta)())},getMsgsByChat:function(a){return k(l({messages:d("MAWTransactionMode").READONLY})(function(b){return b.messages.where("threadJid").equals(a).toArray()})())},getMsgsByMsgId:function(a){return k(l({messages:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTxns").getMsgsByMsgIds)(a))},getMsgsByProtocolMsgId:function(a){return k(l({messages:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTxns").getMsgsByProtocolMsgId)(a))},getParticipantsByParticipantKeys:function(a){return k(l({participants:d("MAWTransactionMode").READONLY})(d("MAWDbParticipantTxns").bulkGetParticipants)(a))},getPendingReceipts:function(a){return k(l({pendingReceipts:d("MAWTransactionMode").READONLY})(d("MAWDbPendingReceiptTxns").getPendingReceipts)(a))},getPersonalSenderKeyStatusesByGroupJid:function(a){return k(m({personalSenderKeyStatuses:d("MAWTransactionMode").READONLY})(d("WADbPersonalSenderKeyStatusTxns").bulkGetPersonalSenderKeyStatuses)(a))},getPrekeyByPrekeyId:function(a){return k(m({prekey:d("MAWTransactionMode").READONLY})(d("WADbPrekeyTxns").getPrekeys)(a))},getPrekeyGenerationByGenerationId:function(a){return k(m({prekeyGeneration:d("MAWTransactionMode").READONLY})(d("WADbPrekeyTxns").getPrekeyGenerations)(a))},getProtocolMsgId:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:a})},getReactionByReactToMsgId:function(a){return k(l({messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY})(function(b){return b.messages.where("msgId").anyOf(a).toArray().then(function(a){return d("MAWDbReactionsTxns").getReactionsFromMessages(b,a)})})(a))},getReceiptByWAMsgId:function(a){return k(m({receipts:d("MAWTransactionMode").READONLY})(function(a,b){return a.receipts.get({waMsgId:b})})(a))},getSenderKeySessionsBySenderKeySessionId:function(a){return k(m({senderKeySessions:d("MAWTransactionMode").READWRITE})(d("WADbSenderKeySessionTxns").getSenderKeySessionsBySenderKeySessionId)(a))},getSessionsByDeviceJid:function(a){return k(m({session:d("MAWTransactionMode").READONLY})(d("WADbSessionTxns").bulkGetSessions)(a))},getSignedPrekesByPrekeyId:function(a){return k(m({signedPrekey:d("MAWTransactionMode").READONLY})(d("WADbSignedPrekeyTxns").getSignedPrekeys)(a))},getThreadsByChatJids:function(a){return k(l({threads:d("MAWTransactionMode").READONLY})(d("MAWDbThreadTxns").getThreads)(a))},getUnArchivedDeviceChangeAlertsCount:function(){return k(l({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn)())},getUnrenderedMsgsByMsgId:function(a){return k(l({unrenderedMessages:d("MAWTransactionMode").READONLY})(d("MAWDbUnrenderedMsgTxns").getUnrenderedMsgsByMsgIds)(a))},getXMAByXMAId:function(a){return k(l({xma:d("MAWTransactionMode").READONLY})(d("MAWDbXMATxns").bulkGetXMAs)(a))},handleEchoMsgsBulkRestore:function(a,b,c,e,f,g,h,i){return k(d("MAWHandleEchoMsgsRestoreApiV2").handleEchoMsgsBulkRestore(a,b,c,e,f,g,h,i))},hmacPlaintextHash:function(a){return d("MAWMediaUtils").genHMACPlaintextHash(a)},hydrateOfflineQueue:d("MAWDebugHydrateOfflineQueue").hydrateOfflineQueue.execute,inflate:function(a){return d("WAGzip").inflate(a)},leaveGroups:function(a){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.leaveGroups(a))},loadMsgs:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;b=(yield d("MAWLoadMsgsApi").loadMsgsFromTs(a.chatJid,(b=a.numMsgs)!=null?b:10,a.direction,a.sortOrderMs,a.loadOriginalMsg,a.msgId,{editMsgHistory:!0,media:!0,reactions:!0,xma:!0}));return babelHelpers["extends"]({},b,{msgs:b.msgs.map(function(a){return babelHelpers["extends"]({},a,{content:a.content!=null?d("MAWVault").unvault(a.content):""})})})});function c(b){return a.apply(this,arguments)}return c}(),makeError:function(a){throw c("unrecoverableViolation")(a,"messenger_web_devx",{error:c("err")(a)})},makeWAError:function(a){d("WALogger").ERROR(i(),a)},markThreadAsRead:function(a,b,c){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.markThreadAsRead(a,null,!1,!1,b,c,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}))},notifyDeviceChange:function(a){return c("WAAPI").notifyDeviceChange({users:a})},overrideAbProp:function(a,b){d("WAAbPropsInit").overrideAbProp(a,b)},promoteGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.promoteGroupParticipants(a,b))},protocolQueue:function(){return d("WAProtocolQueue").protocolQueue()},putGroupInvite:function(a){return k(l({groupInvites:d("MAWTransactionMode").READWRITE})(d("MAWDbGroupInviteTxns").putGroupInvite)(a))},putNewPersonalSenderKeyStatus:function(a){return m({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE})(d("WADbPersonalSenderKeyStatusTxns").putNewPersonalSenderKeyStatus)(a)},queryAllGroups:function(){return c("WAAPI").queryGroups({type:"all"}).then(function(){})},readProtocolQueue:function(){return d("WAProtocolQueue").protocolQueue().read()},removeDevice:function(a,b){return c("WAAPI").removeDevice({deviceId:a,identity:b})},removeGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.removeGroupParticipants(a,b))},reportUserSpam:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.reportUserSpam(a,"frx",b,!1,["harassment"],"fake debug context"))},reregisterPhone:function(){return d("WAHandleFailureUtils").reregisterPhone()},restoreMessagesFromEncryptedBackups:function(a,b,c,e,f,g,h,i,j,l){return k(d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,b,c,e,f,g,h,i,j,l)))},revokeMsg:function(a){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.revokeMsgs([a]))},rotateSignedPreKey:function(){return d("WARotateSignedPreKey").rotateSignedPreKey()},sendAppData:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendAppData({contents:a,deviceJids:b}))},sendEditMsg:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendEditMsg(a,b))},sendEphemeralSettingMsg:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendEphemeralSettingMsg(a,b))},sendInvisibleMsg:function(a){return d("MAWSendSenderKeyDistributionMsg").sendSenderKeyDistributionMsg(a,d("MAWExternalId").generateExternalId())},sendInvisibleMsgToAllExistingGroups:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield l({groupInfo:d("MAWTransactionMode").READONLY})(function(a){return a.groupInfo.toArray()})()),b=[];for(a of a)b.push(d("MAWSendSenderKeyDistributionMsg").sendSenderKeyDistributionMsg(a.groupJid,d("MAWExternalId").generateExternalId()));return b});function c(){return a.apply(this,arguments)}return c}(),sendMessageTooAllExistingGroups:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield l({groupInfo:d("MAWTransactionMode").READONLY})(function(a){return a.groupInfo.toArray()})()),b=[];for(a of a)b.push(j.sendMsg(a.groupJid,{content:"message to "+a.groupJid+" at "+new Date().getTime()}));return b});function c(){return a.apply(this,arguments)}return c}(),sendMsg:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendMsg(a,b))},sendMultipleMsgs:d("MAWDebugSendMultipleMsgs").sendMultipleMsgs.execute,sendRavenActionMsg:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendRavenActionMsg(a,b))},sendReaction:function(a,b,c,e){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendReactionMsg(a,b,c,e))},sendXMAShareMsg:function(a,b,c,e){var f=new File(["Hello"],"aaa",{type:"image/jpeg"});return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendXMAShareMsg(a,{file:f,height:0,width:0},void 0,void 0,(a=c)!=null?a:"hey",babelHelpers["extends"]({},b,{xmaMessageType:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY}),void 0,void 0,e))},setEphemeralSettingWithoutUpdate:function(a,b,c,e){c=c==null?d("WATimeUtils").unixTime():d("WATimeUtils").futureUnixTime(c);return k(l({ephemeralSettings:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(d("MAWEphemeralSettingsTxns").handleAndWriteOutgoingUserEphemeralSettingChange)(a,b,c,e))},setGroupSubject:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.setGroupSubject(a,b))},setICDCData:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=(yield d("WAGetContactAndIdentitiesApi").getContactAndIdentitiesForUser(a));if(!e.success)return"generateICDCInfo failed with error "+e.error;else if(e.value==null)return"Could not find contact info";var f=e.value.contact,g=f.icdcInfo;if(g==null)return"Could not find contact ICDC info";var h=g.sequence;c.sequenceInc!=null&&(h=g.sequence+c.sequenceInc);var i=d("WAJids").interpretAsDeviceId(999);yield d("WAGlobals").getWaOneQueue().enqueue(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b.cryptoManager;if(c.additionDevices==="inject"){var f=d("WASignalOther").makeBytes(33);f[0]=5;e.value.identities.push({deviceJid:d("WAJids").toDeviceJid(a,i),identity:f});yield b.storage.updateUserDevicesInfo([{devices:e.value.identities.map(function(a){var b=a.deviceJid;a=a.identity;return{id:d("WAJids").extractDeviceId(b),identity:a}}),dhash:null,icdcInfo:null,jid:a,lastSyncTs:d("WATimeUtils").unixTime(),notificationTs:null}])}else c.additionDevices==="clear"&&(yield b.storage.updateUserDevicesInfo([{devices:e.value.identities.filter(function(b){return b.deviceJid!==d("WAJids").toDeviceJid(a,i)}).map(function(a){var b=a.deviceJid;a=a.identity;return{id:d("WAJids").extractDeviceId(b),identity:a}}),dhash:null,icdcInfo:null,jid:a,lastSyncTs:d("WATimeUtils").unixTime(),notificationTs:null}]))});return function(a){return f.apply(this,arguments)}}(),{afterInit:!0,flush:!0,operationType:"debug_operation"});return k(m({contacts:d("MAWTransactionMode").READWRITE})(function(b){return b.contacts.get(a).then(function(a){if(a!=null){a.icdcInfo=babelHelpers["extends"]({},g,{sequence:h});c.resetICDCError===!0&&(a.icdcFails=void 0);a.lastSyncTs=d("WATimeUtils").unixTime();return b.contacts.put(a).then(function(){return"contact-updated"})}return"contact-missing"})})())});function c(b,c){return a.apply(this,arguments)}return c}(),syncAbProps:function(a){a=a!==!0;return c("WAAPI").syncAbProps({sendHash:a})},updateDeviceChangeAlerts:function(a){return k(l({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn)(a))},updateDeviceChangeAlertsLLA:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","updateDeviceChangeAlerts",{alert:a})},updateDeviceChangeAlertsLogInStatus:function(a){return k(l({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn)(a))},uploadRetroactiveThreadsAndMessages:function(){return k(d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.uploadRetroactiveThreadsAndMessages()))}};function k(a){return a.then(function(a){return a})}c("gkx")("23903")&&(self.Debug=j,self.WAAPI=c("WAAPI"));function l(a){return function(b){return d("MAWTransactor").makeMsgrTransactor(a,"debug",function(a){return function(){for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b.apply(void 0,[a].concat(d))}})}}function m(a){return function(b){return d("WADbTransactor").makeSignalTransactor(a,"debug",function(a){return function(){for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b.apply(void 0,[a].concat(d))}})}}g.MAWDebugFuncs=j}),98);
__d("MAWDebugSendReaction",["MAWJobDefinitions","MAWJobManager","WADevToolsDebugFns"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADevToolsDebugFns").defineDebugFunction("sendReaction",{desc:"Sends reaction to a message",execute:function(a,b,c,e){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendReactionMsg(a,b,c,e))},serializedArgs:[{desc:"ChatJid of the thread containing the message to react to",name:"chatJid",placeholder:"ChatJid",type:"string"},{desc:"ProtocolMsgId of the message to react to",name:"reactTo",placeholder:"ProtocolMsgId",type:"object"},{desc:"FBID of the author of the message to react to",name:"author",placeholder:"FBID",type:"string"},{desc:"Reaction emoji to use",name:"reaction",placeholder:"\ud83d\ude00",type:"string"}]});g.sendReaction=a}),98);
__d("MAWDebugDefineFunctions",["MAWDebug","MAWDebugHydrateOfflineQueue","MAWDebugSendMultipleMsgs","MAWDebugSendReaction"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return{desc:a,execute:b,name:a,serializedArgs:[]}}function a(){var a=Object.keys(d("MAWDebug").MAWDebugFuncs).reduce(function(a,b){return Object.assign(a,(a={},a[b]=h(b,d("MAWDebug").MAWDebugFuncs[b]),a))},{});return babelHelpers["extends"]({},a,{hydrateOfflineQueue:d("MAWDebugHydrateOfflineQueue").hydrateOfflineQueue,sendMultipleMsgs:d("MAWDebugSendMultipleMsgs").sendMultipleMsgs,sendReaction:d("MAWDebugSendReaction").sendReaction})}g.getAllDebugFunctions=a}),98);
__d("WADebugTools",["WADevToolsDebugFns"],(function(a,b,c,d,e,f,g){"use strict";function a(a){self.Debug==null&&(self.Debug={});var b=function(b){var c=a[b];self.Debug[c.name]=function(){return c.execute.apply(c,arguments)}};for(var c in a)b(c);d("WADevToolsDebugFns").registerDebugFnsToDevTool(a)}g.initDebugFunctions=a}),98);